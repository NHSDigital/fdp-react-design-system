{
  "version": 3,
  "sources": ["../../src/behaviours/buttonBehaviour.ts"],
  "sourcesContent": ["// Behaviour layer for Button component\n// This file encapsulates stateful / interactive logic that can be reused across\n// frameworks (React, Nunjucks-enhanced HTML with progressive enhancement, plain JS)\n// without tying to a rendering library.\n\nexport interface ButtonBehaviourOptions {\n  preventDoubleClick?: boolean;\n  onClick?: (ev: MouseEvent) => void;\n}\n\nexport interface ButtonBehaviourHandles {\n  attach: (el: HTMLElement) => void;\n  detach: () => void;\n}\n\n/**\n * Provides progressive enhancement behaviour for buttons / links that use\n * data-module=\"nhs-button\". Mirrors logic in the React implementation so that\n * SSR + static HTML + Nunjucks macros remain consistent.\n */\nexport function createButtonBehaviour(options: ButtonBehaviourOptions = {}): ButtonBehaviourHandles {\n  let el: HTMLElement | null = null;\n  const { preventDoubleClick, onClick } = options;\n  let processingTimeout: number | null = null;\n\n  const handleClick = (e: MouseEvent) => {\n    if (preventDoubleClick) {\n      if (el?.getAttribute('data-processing') === 'true') {\n        e.preventDefault();\n        return;\n      }\n      el?.setAttribute('data-processing', 'true');\n      processingTimeout = window.setTimeout(() => {\n        el?.removeAttribute('data-processing');\n        processingTimeout = null;\n      }, 1000);\n    }\n    onClick?.(e);\n  };\n\n  const handleKeyDown = (e: KeyboardEvent) => {\n    if (!el) return;\n    // Space triggers click when role=button on anchor\n    if (e.key === ' ' && el.tagName === 'A') {\n      e.preventDefault();\n      el.click();\n    }\n  };\n\n  return {\n    attach(element: HTMLElement) {\n      el = element;\n      el.addEventListener('click', handleClick);\n      el.addEventListener('keydown', handleKeyDown);\n    },\n    detach() {\n      if (!el) return;\n      el.removeEventListener('click', handleClick);\n      el.removeEventListener('keydown', handleKeyDown);\n      if (processingTimeout) window.clearTimeout(processingTimeout);\n      el = null;\n    }\n  };\n}\n\n// Auto-init pattern (optional, guarded for multiple executions)\nexport function initButtons(scope: ParentNode = document) {\n  const nodes = Array.from(scope.querySelectorAll<HTMLElement>('[data-module=\"nhs-button\"][data-prevent-double-click]'));\n  nodes.forEach(node => {\n    // Extend node with opaque symbol property for idempotence\n    interface BehaviourNode extends HTMLElement { __nhsButtonBehaviour?: ButtonBehaviourHandles }\n    const n = node as BehaviourNode;\n    if (!n.__nhsButtonBehaviour) {\n      const behaviour = createButtonBehaviour({ preventDoubleClick: true });\n      behaviour.attach(n);\n      n.__nhsButtonBehaviour = behaviour;\n    }\n  });\n}\n\nexport function detachButtons(scope: ParentNode = document) {\n  const nodes = Array.from(scope.querySelectorAll<HTMLElement>('[data-module=\"nhs-button\"][data-prevent-double-click]'));\n  nodes.forEach(node => {\n    interface BehaviourNode extends HTMLElement { __nhsButtonBehaviour?: ButtonBehaviourHandles }\n    const n = node as BehaviourNode;\n    if (n.__nhsButtonBehaviour) { n.__nhsButtonBehaviour.detach(); delete n.__nhsButtonBehaviour; }\n  });\n}\n\n// Provide a global init hook when running in browser environment\nif (typeof window !== 'undefined') {\n  // @ts-ignore\n  if (!window.__nhsInitButtons) {\n    // @ts-ignore\n  window.__nhsInitButtons = initButtons;\n  // @ts-ignore\n  window.__nhsDetachButtons = detachButtons;\n    if (document.readyState === 'loading') {\n      document.addEventListener('DOMContentLoaded', () => initButtons());\n    } else {\n      initButtons();\n    }\n  }\n}\n"],
  "mappings": "AAoBO,SAAS,sBAAsB,UAAkC,CAAC,GAA2B;AAClG,MAAI,KAAyB;AAC7B,QAAM,EAAE,oBAAoB,QAAQ,IAAI;AACxC,MAAI,oBAAmC;AAEvC,QAAM,cAAc,CAAC,MAAkB;AACrC,QAAI,oBAAoB;AACtB,WAAI,yBAAI,aAAa,wBAAuB,QAAQ;AAClD,UAAE,eAAe;AACjB;AAAA,MACF;AACA,+BAAI,aAAa,mBAAmB;AACpC,0BAAoB,OAAO,WAAW,MAAM;AAC1C,iCAAI,gBAAgB;AACpB,4BAAoB;AAAA,MACtB,GAAG,GAAI;AAAA,IACT;AACA,uCAAU;AAAA,EACZ;AAEA,QAAM,gBAAgB,CAAC,MAAqB;AAC1C,QAAI,CAAC,GAAI;AAET,QAAI,EAAE,QAAQ,OAAO,GAAG,YAAY,KAAK;AACvC,QAAE,eAAe;AACjB,SAAG,MAAM;AAAA,IACX;AAAA,EACF;AAEA,SAAO;AAAA,IACL,OAAO,SAAsB;AAC3B,WAAK;AACL,SAAG,iBAAiB,SAAS,WAAW;AACxC,SAAG,iBAAiB,WAAW,aAAa;AAAA,IAC9C;AAAA,IACA,SAAS;AACP,UAAI,CAAC,GAAI;AACT,SAAG,oBAAoB,SAAS,WAAW;AAC3C,SAAG,oBAAoB,WAAW,aAAa;AAC/C,UAAI,kBAAmB,QAAO,aAAa,iBAAiB;AAC5D,WAAK;AAAA,IACP;AAAA,EACF;AACF;AAGO,SAAS,YAAY,QAAoB,UAAU;AACxD,QAAM,QAAQ,MAAM,KAAK,MAAM,iBAA8B,uDAAuD,CAAC;AACrH,QAAM,QAAQ,UAAQ;AAGpB,UAAM,IAAI;AACV,QAAI,CAAC,EAAE,sBAAsB;AAC3B,YAAM,YAAY,sBAAsB,EAAE,oBAAoB,KAAK,CAAC;AACpE,gBAAU,OAAO,CAAC;AAClB,QAAE,uBAAuB;AAAA,IAC3B;AAAA,EACF,CAAC;AACH;AAEO,SAAS,cAAc,QAAoB,UAAU;AAC1D,QAAM,QAAQ,MAAM,KAAK,MAAM,iBAA8B,uDAAuD,CAAC;AACrH,QAAM,QAAQ,UAAQ;AAEpB,UAAM,IAAI;AACV,QAAI,EAAE,sBAAsB;AAAE,QAAE,qBAAqB,OAAO;AAAG,aAAO,EAAE;AAAA,IAAsB;AAAA,EAChG,CAAC;AACH;AAGA,IAAI,OAAO,WAAW,aAAa;AAEjC,MAAI,CAAC,OAAO,kBAAkB;AAE9B,WAAO,mBAAmB;AAE1B,WAAO,qBAAqB;AAC1B,QAAI,SAAS,eAAe,WAAW;AACrC,eAAS,iBAAiB,oBAAoB,MAAM,YAAY,CAAC;AAAA,IACnE,OAAO;AACL,kBAAY;AAAA,IACd;AAAA,EACF;AACF;",
  "names": []
}
