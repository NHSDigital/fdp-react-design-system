{
  "version": 3,
  "sources": ["../../src/behaviours/characterCountBehaviour.ts"],
  "sourcesContent": ["// Behaviour layer for CharacterCount component (progressive enhancement)\n// Mirrors logic from React version for static/Nunjucks HTML.\n\ninterface CharacterCountHandles { detach: () => void }\ninterface CharacterCountRoot extends HTMLElement { __nhsCharacterCount?: CharacterCountHandles }\n\nfunction enhanceCharacterCount(root: CharacterCountRoot): CharacterCountHandles {\n  const textarea = root.querySelector<HTMLTextAreaElement>('textarea');\n  const message = root.querySelector<HTMLElement>('.nhsuk-character-count__message, .nhsuk-hint');\n  if (!textarea || !message) return { detach: () => {} };\n\n  const maxLength = Number(root.getAttribute('data-maxlength')) || undefined;\n  const maxWords = Number(root.getAttribute('data-maxwords')) || undefined;\n  const threshold = Number(root.getAttribute('data-threshold')) || 0;\n  const limit = maxLength || maxWords || 0;\n\n  const unit = maxWords ? 'word' : 'character';\n  const unitPlural = maxWords ? 'words' : 'characters';\n\n  function countValue(val: string): number {\n    if (maxWords) {\n      const t = val.trim();\n      if (!t) return 0;\n      return t.split(/\\s+/).length;\n    }\n    return val.length;\n  }\n\n  function update() {\n  const text = textarea!.value;\n    const current = countValue(text);\n    const remaining = limit - current;\n    const thresholdCount = Math.floor(limit * (threshold / 100));\n    const showCount = current >= thresholdCount || current > limit;\n    const isOver = current > limit;\n    let msg: string;\n    if (!showCount) {\n      msg = `You can enter up to ${limit} ${limit === 1 ? unit : unitPlural}`;\n    } else if (isOver) {\n      const over = Math.abs(remaining);\n      msg = `You have ${over} ${over === 1 ? unit : unitPlural} too many`;\n    } else {\n      msg = `You have ${remaining} ${remaining === 1 ? unit : unitPlural} remaining`;\n    }\n  message!.textContent = msg;\n  // Toggle error styling\n  message!.classList.toggle('nhsuk-error-message', isOver);\n  if (isOver) textarea!.setAttribute('aria-invalid', 'true'); else textarea!.removeAttribute('aria-invalid');\n    // Dispatch event\n    root.dispatchEvent(new CustomEvent('nhs:character-count:update', { bubbles: true, detail: { current, remaining, isOverLimit: isOver } }));\n  }\n\n  const handler = () => update();\n  textarea!.addEventListener('input', handler);\n  update();\n\n  return { detach() { textarea!.removeEventListener('input', handler); } };\n}\n\nexport function initCharacterCounts(scope: ParentNode = document) {\n  const roots = Array.from(scope.querySelectorAll<CharacterCountRoot>('[data-module=\"nhsuk-character-count\"]'));\n  roots.forEach(r => { if (!r.__nhsCharacterCount) r.__nhsCharacterCount = enhanceCharacterCount(r); });\n}\n\nexport function detachCharacterCounts(scope: ParentNode = document) {\n  const roots = Array.from(scope.querySelectorAll<CharacterCountRoot>('[data-module=\"nhsuk-character-count\"]'));\n  roots.forEach(r => { r.__nhsCharacterCount?.detach(); delete r.__nhsCharacterCount; });\n}\n\nif (typeof window !== 'undefined') {\n  // @ts-ignore\n  if (!window.__nhsInitCharacterCounts) {\n    // @ts-ignore\n  window.__nhsInitCharacterCounts = initCharacterCounts;\n  // @ts-ignore\n  window.__nhsDetachCharacterCounts = detachCharacterCounts;\n    if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', () => initCharacterCounts()); else initCharacterCounts();\n  }\n}\n"],
  "mappings": "AAMA,SAAS,sBAAsB,MAAiD;AAC9E,QAAM,WAAW,KAAK,cAAmC,UAAU;AACnE,QAAM,UAAU,KAAK,cAA2B,8CAA8C;AAC9F,MAAI,CAAC,YAAY,CAAC,QAAS,QAAO,EAAE,QAAQ,MAAM;AAAA,EAAC,EAAE;AAErD,QAAM,YAAY,OAAO,KAAK,aAAa,gBAAgB,CAAC,KAAK;AACjE,QAAM,WAAW,OAAO,KAAK,aAAa,eAAe,CAAC,KAAK;AAC/D,QAAM,YAAY,OAAO,KAAK,aAAa,gBAAgB,CAAC,KAAK;AACjE,QAAM,QAAQ,aAAa,YAAY;AAEvC,QAAM,OAAO,WAAW,SAAS;AACjC,QAAM,aAAa,WAAW,UAAU;AAExC,WAAS,WAAW,KAAqB;AACvC,QAAI,UAAU;AACZ,YAAM,IAAI,IAAI,KAAK;AACnB,UAAI,CAAC,EAAG,QAAO;AACf,aAAO,EAAE,MAAM,KAAK,EAAE;AAAA,IACxB;AACA,WAAO,IAAI;AAAA,EACb;AAEA,WAAS,SAAS;AAClB,UAAM,OAAO,SAAU;AACrB,UAAM,UAAU,WAAW,IAAI;AAC/B,UAAM,YAAY,QAAQ;AAC1B,UAAM,iBAAiB,KAAK,MAAM,SAAS,YAAY,IAAI;AAC3D,UAAM,YAAY,WAAW,kBAAkB,UAAU;AACzD,UAAM,SAAS,UAAU;AACzB,QAAI;AACJ,QAAI,CAAC,WAAW;AACd,YAAM,uBAAuB,KAAK,IAAI,UAAU,IAAI,OAAO,UAAU;AAAA,IACvE,WAAW,QAAQ;AACjB,YAAM,OAAO,KAAK,IAAI,SAAS;AAC/B,YAAM,YAAY,IAAI,IAAI,SAAS,IAAI,OAAO,UAAU;AAAA,IAC1D,OAAO;AACL,YAAM,YAAY,SAAS,IAAI,cAAc,IAAI,OAAO,UAAU;AAAA,IACpE;AACF,YAAS,cAAc;AAEvB,YAAS,UAAU,OAAO,uBAAuB,MAAM;AACvD,QAAI,OAAQ,UAAU,aAAa,gBAAgB,MAAM;AAAA,QAAQ,UAAU,gBAAgB,cAAc;AAEvG,SAAK,cAAc,IAAI,YAAY,8BAA8B,EAAE,SAAS,MAAM,QAAQ,EAAE,SAAS,WAAW,aAAa,OAAO,EAAE,CAAC,CAAC;AAAA,EAC1I;AAEA,QAAM,UAAU,MAAM,OAAO;AAC7B,WAAU,iBAAiB,SAAS,OAAO;AAC3C,SAAO;AAEP,SAAO,EAAE,SAAS;AAAE,aAAU,oBAAoB,SAAS,OAAO;AAAA,EAAG,EAAE;AACzE;AAEO,SAAS,oBAAoB,QAAoB,UAAU;AAChE,QAAM,QAAQ,MAAM,KAAK,MAAM,iBAAqC,uCAAuC,CAAC;AAC5G,QAAM,QAAQ,OAAK;AAAE,QAAI,CAAC,EAAE,oBAAqB,GAAE,sBAAsB,sBAAsB,CAAC;AAAA,EAAG,CAAC;AACtG;AAEO,SAAS,sBAAsB,QAAoB,UAAU;AAClE,QAAM,QAAQ,MAAM,KAAK,MAAM,iBAAqC,uCAAuC,CAAC;AAC5G,QAAM,QAAQ,OAAK;AAlErB;AAkEuB,YAAE,wBAAF,mBAAuB;AAAU,WAAO,EAAE;AAAA,EAAqB,CAAC;AACvF;AAEA,IAAI,OAAO,WAAW,aAAa;AAEjC,MAAI,CAAC,OAAO,0BAA0B;AAEtC,WAAO,2BAA2B;AAElC,WAAO,6BAA6B;AAClC,QAAI,SAAS,eAAe,UAAW,UAAS,iBAAiB,oBAAoB,MAAM,oBAAoB,CAAC;AAAA,QAAQ,qBAAoB;AAAA,EAC9I;AACF;",
  "names": []
}
