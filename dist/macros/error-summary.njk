{# ErrorSummary macro (schema + manual template) #}
{% macro errorSummary(params) %}
  {% set titleText = params.titleHtml and '' or (params.titleText or 'There is a problem') %}
  <div class="nhsuk-error-summary{% if params.className %} {{ params.className }}{% endif %}" aria-labelledby="error-summary-title" role="alert" tabindex="-1" data-module="nhsuk-error-summary">
    <h2 class="nhsuk-error-summary__title" id="error-summary-title">{% if params.titleHtml %}<span>{{ params.titleHtml | safe }}</span>{% else %}{{ titleText }}{% endif %}</h2>
    <div class="nhsuk-error-summary__body">
      {% if params.children %}
        <div class="nhsuk-error-summary__description" data-role="description">{{ params.children | safe }}</div>
      {% elif params.descriptionHtml or params.descriptionText %}
        <div class="nhsuk-error-summary__description" data-role="description">{% if params.descriptionHtml %}<span>{{ params.descriptionHtml | safe }}</span>{% else %}{{ params.descriptionText }}{% endif %}</div>
      {% endif %}
      <ul class="nhsuk-list nhsuk-error-summary__list" role="list">
        {% for item in params.errorList %}
          <li>{% if item.href %}<a href="{{ item.href }}"{% if item.attributes %}{% for k,v in item.attributes %} {{ k }}="{{ v }}"{% endfor %}{% endif %}>{% if item.html %}<span>{{ item.html | safe }}</span>{% else %}{{ item.text }}{% endif %}</a>{% else %}{% if item.html %}<span>{{ item.html | safe }}</span>{% else %}{{ item.text }}{% endif %}{% endif %}</li>
        {% endfor %}
      </ul>
    </div>
  </div>
{% endmacro %}
