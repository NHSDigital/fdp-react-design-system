{"version":3,"file":"react.js","sources":["../../../src/behaviours/BehavioursLoader.tsx"],"sourcesContent":["/**\n * BehavioursLoader - React component for loading and initializing behaviours after hydration\n * \n * This client component ensures behaviours are initialized after React hydration completes,\n * preventing SSR/client attribute mismatches and hydration warnings. It dynamically imports\n * the behaviours bundle to keep it out of the server chunk.\n * \n * @example\n * ```tsx\n * // app/layout.tsx (Next.js App Router)\n * import { BehavioursLoader } from '@fergusbisset/nhs-fdp-design-system/behaviours';\n * \n * export default function RootLayout({ children }) {\n *   return (\n *     <html>\n *       <body>\n *         {children}\n *         <BehavioursLoader />\n *       </body>\n *     </html>\n *   );\n * }\n * ```\n * \n * @example\n * ```tsx\n * // Scoped initialization\n * <div ref={containerRef}>\n *   <YourComponents />\n *   <BehavioursLoader scope={containerRef.current} />\n * </div>\n * ```\n */\n\n\"use client\";\nimport { useEffect } from \"react\";\n\nexport interface BehavioursLoaderProps {\n\t/**\n\t * Optional scope to limit behaviour initialization to a specific container.\n\t * If not provided, behaviours will be initialized on the entire document.\n\t */\n\tscope?: ParentNode | null;\n\t\n\t/**\n\t * Optional callback invoked after behaviours are successfully initialized.\n\t */\n\tonInit?: () => void;\n\t\n\t/**\n\t * Optional callback invoked if behaviour initialization fails.\n\t */\n\tonError?: (error: unknown) => void;\n}\n\nexport function BehavioursLoader({ scope, onInit, onError }: BehavioursLoaderProps = {}) {\n\tuseEffect(() => {\n\t\tif (typeof window === \"undefined\") return;\n\n\t\t// Prevent behaviours module from auto-initialising on import\n\t\t// We'll set the real function after we import, and then run it.\n\t\tif (!(window as any).__nhsInitAllBehaviours) {\n\t\t\t(window as any).__nhsInitAllBehaviours = () => {};\n\t\t}\n\n\t\t// Dynamic import keeps the behaviours bundle out of the server chunk\n\t\t// and only loads it in the browser on demand\n\t\timport(\"./index.js\")\n\t\t\t.then(({ initAll }) => {\n\t\t\t\t// Replace shim with real function\n\t\t\t\t(window as any).__nhsInitAllBehaviours = initAll;\n\t\t\t\t\n\t\t\t\ttry {\n\t\t\t\t\t// Initialize behaviours after React hydration\n\t\t\t\t\tconst target = scope || document;\n\t\t\t\t\tinitAll(target);\n\t\t\t\t\tonInit?.();\n\t\t\t\t} catch (e) {\n\t\t\t\t\t// Log error but don't break the page\n\t\t\t\t\tconsole.error('[BehavioursLoader] Failed to initialize behaviours:', e);\n\t\t\t\t\tonError?.(e);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\tconsole.error('[BehavioursLoader] Failed to load behaviours module:', error);\n\t\t\t\tonError?.(error);\n\t\t\t});\n\t}, [scope, onInit, onError]);\n\n\treturn null;\n}\n"],"names":["BehavioursLoader","scope","onInit","onError","useEffect","initAll","e","error"],"mappings":";;AAuDO,SAASA,EAAiB,EAAE,OAAAC,GAAO,QAAAC,GAAQ,SAAAC,EAAA,IAAmC,CAAA,GAAI;AACxF,SAAAC,EAAU,MAAM;AACf,IAAI,OAAO,SAAW,QAIhB,OAAe,2BACnB,OAAe,yBAAyB,MAAM;AAAA,IAAC,IAKjD,OAAO,qBAAY,EACjB,KAAK,CAAC,EAAE,SAAAC,QAAc;AAErB,aAAe,yBAAyBA;AAEzC,UAAI;AAGH,QAAAA,EADeJ,KAAS,QACV,GACdC,IAAA;AAAA,MACD,SAASI,GAAG;AAEX,gBAAQ,MAAM,uDAAuDA,CAAC,GACtEH,IAAUG,CAAC;AAAA,MACZ;AAAA,IACD,CAAC,EACA,MAAM,CAACC,MAAU;AACjB,cAAQ,MAAM,wDAAwDA,CAAK,GAC3EJ,IAAUI,CAAK;AAAA,IAChB,CAAC;AAAA,EACH,GAAG,CAACN,GAAOC,GAAQC,CAAO,CAAC,GAEpB;AACR;"}