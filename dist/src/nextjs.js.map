{"version":3,"file":"nextjs.js","sources":["../../src/nextjs/useNavigationSplitNextUrlSync.ts","../../src/nextjs/NHSBehavioursInit.tsx","../../src/nextjs/InitBehaviours.tsx"],"sourcesContent":["// Next.js (App Router) specific URL sync hook for NavigationSplitView\n// This file is only bundled when importing from the /nextjs entry.\n// It assumes a Next.js environment where `next/navigation` exists.\nimport * as React from 'react';\n\n// Dynamically (optionally) load next/navigation so the library can build\n// without Next.js installed (optional peer). We intentionally avoid a\n// static import because Vite's optional peer plugin rewrites it and\n// Rollup then verifies named exports that won't exist when Next is absent.\n// Using a guarded require keeps this entry tree‑shakable for non‑Next\n// consumers while still providing full behaviour in a Next environment.\n\nlet nextNav: any | null = null;\ntry {\n  // Use Function constructor to avoid bundlers trying to resolve at build.\n  const req = (Function('return require'))();\n  nextNav = req('next/navigation');\n} catch {\n  nextNav = null;\n}\n\nconst useSearchParams = nextNav?.useSearchParams as (() => URLSearchParams) | undefined;\nconst usePathname = nextNav?.usePathname as (() => string) | undefined;\ninterface NextRouterLike { push: (url: string, opts?: { scroll?: boolean; shallow?: boolean }) => void; replace: (url: string, opts?: { scroll?: boolean; shallow?: boolean }) => void; }\nconst useRouter = nextNav?.useRouter as (() => NextRouterLike) | undefined;\n\nexport interface UseNavigationSplitNextUrlSyncOptions {\n  paramSelected?: string;\n  paramDrill?: string;\n  /** Navigation method for updates (default replace to avoid history spam) */\n  method?: 'replace' | 'push';\n}\n\nexport function useNavigationSplitNextUrlSync<ID = string>(options: UseNavigationSplitNextUrlSyncOptions = {}) {\n  const { paramSelected = 'nsv', paramDrill = 'nsvDrill', method = 'replace' } = options;\n\n  if (!useSearchParams || !usePathname || !useRouter) {\n    if (process.env.NODE_ENV !== 'production') {\n      console.warn('[useNavigationSplitNextUrlSync] next/navigation not available – returning inert helpers. Import this hook only within a Next.js App Router environment.');\n    }\n    return {\n      selectedId: undefined as ID | undefined,\n      drilledIn: false,\n      setSelectedId: () => {},\n      setDrilledIn: () => {}\n    } as const;\n  }\n\n  const searchParams = useSearchParams();\n  const pathname = usePathname();\n  const router = useRouter();\n\n  const selectedId = (searchParams.get(paramSelected) as ID | null | undefined) || undefined;\n  const drilledIn = searchParams.get(paramDrill) === '1';\n\n  const update = React.useCallback((nextSelected: ID | undefined, nextDrilled: boolean) => {\n    const sp = new URLSearchParams(searchParams.toString());\n    if (nextSelected) sp.set(paramSelected, String(nextSelected)); else sp.delete(paramSelected);\n    sp.set(paramDrill, nextDrilled ? '1' : '0');\n    const qs = sp.toString();\n    const url = qs ? `${pathname}?${qs}` : pathname;\n    const nav = method === 'push' ? router.push : router.replace;\n    nav(url, { scroll: false });\n  }, [searchParams, pathname, router, method, paramSelected, paramDrill]);\n\n  return {\n    selectedId,\n    drilledIn,\n    setSelectedId: (id: ID | undefined) => update(id, drilledIn),\n    setDrilledIn: (d: boolean) => update(selectedId, d)\n  } as const;\n}\n\nexport type UseNavigationSplitNextUrlSyncReturn<ID = string> = ReturnType<typeof useNavigationSplitNextUrlSync<ID>>;\n","\"use client\";\n\n/**\n * Client-only behaviours initializer for Next.js apps.\n *\n * Purpose:\n * - Ensures the behaviours bundle is included in the consuming app's client build\n * - Exposes expected globals for the SSR header inline script\n * - Triggers initialisation after hydration\n *\n * Usage (App Router):\n *   import { NHSBehavioursInit } from '@nhsdigital/fdp-design-system/nextjs';\n *   // in app/layout.tsx (Server Component)\n *   <body>\n *     <NHSBehavioursInit />\n *     <HeaderServer ... />\n *     {children}\n *   </body>\n */\nimport { useEffect } from \"react\";\n\nexport function NHSBehavioursInit() {\n\tuseEffect(() => {\n\t\tlet cancelled = false;\n\n\t\t(async () => {\n\t\t\ttry {\n\t\t\t\t// Import via the package export so Next bundles it for the client.\n\t\t\t\tconst mod: any = await import(\n\t\t\t\t\t\"@nhsdigital/fdp-design-system/behaviours\"\n\t\t\t\t);\n\t\t\t\tif (cancelled) return;\n\n\t\t\t\t// The behaviours bundle already exposes globals when loaded.\n\t\t\t\t// For determinism in hydration-sensitive apps, also invoke initAll immediately if present.\n\t\t\t\tif (mod && typeof mod.initAll === \"function\") {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tmod.initAll(document);\n\t\t\t\t\t} catch {}\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error(\"NHSBehavioursInit: failed to load behaviours\", err);\n\t\t\t}\n\t\t})();\n\n\t\treturn () => {\n\t\t\tcancelled = true;\n\t\t};\n\t}, []);\n\n\treturn null;\n}\n","/**\n * DEPRECATED: Use <NHSBehavioursInit /> instead.\n * This wrapper forwards to the client-only component to ensure bundler-safe behaviour loading.\n */\nimport { NHSBehavioursInit } from './NHSBehavioursInit';\n\n/** @deprecated Use <NHSBehavioursInit /> instead. */\nexport function InitBehaviours() {\n\t// Forward to the client component. This avoids brittle inline script imports.\n\treturn <NHSBehavioursInit />;\n}\n\n/**\n * Alternative: Direct inline initialization (no dynamic import)\n * Use this if you want behaviours bundled with your app bundle\n * \n * @example\n * ```tsx\n * import { InitBehavioursInline } from '@nhsdigital/fdp-design-system/nextjs'\n * \n * export default function RootLayout({ children }) {\n *   return (\n *     <html>\n *       <body>\n *         {children}\n *         <InitBehavioursInline />\n *       </body>\n *     </html>\n *   )\n * }\n * ```\n */\n/** @deprecated Use <NHSBehavioursInit /> instead. */\nexport function InitBehavioursInline() {\n\treturn <NHSBehavioursInit />;\n}\n"],"names":["nextNav","useSearchParams","usePathname","useRouter","useNavigationSplitNextUrlSync","options","paramSelected","paramDrill","method","searchParams","pathname","router","selectedId","drilledIn","update","React","nextSelected","nextDrilled","sp","qs","url","id","d","NHSBehavioursInit","useEffect","cancelled","mod","err","InitBehaviours","InitBehavioursInline"],"mappings":";;;;AAYA,IAAIA,IAAsB;AAC1B,IAAI;AAGF,EAAAA,IADa,SAAS,gBAAgB,EAAA,EACxB,iBAAiB;AACjC,QAAQ;AACN,EAAAA,IAAU;AACZ;AAEA,MAAMC,IAAkBD,GAAS,iBAC3BE,IAAcF,GAAS,aAEvBG,IAAYH,GAAS;AASpB,SAASI,EAA2CC,IAAgD,IAAI;AAC7G,QAAM,EAAE,eAAAC,IAAgB,OAAO,YAAAC,IAAa,YAAY,QAAAC,IAAS,cAAcH;AAE/E,MAAI,CAACJ,KAAmB,CAACC,KAAe,CAACC;AACvC,WAAI,QAAQ,IAAI,aAAa,gBAC3B,QAAQ,KAAK,yJAAyJ,GAEjK;AAAA,MACL,YAAY;AAAA,MACZ,WAAW;AAAA,MACX,eAAe,MAAM;AAAA,MAAC;AAAA,MACtB,cAAc,MAAM;AAAA,MAAC;AAAA,IAAA;AAIzB,QAAMM,IAAeR,EAAA,GACfS,IAAWR,EAAA,GACXS,IAASR,EAAA,GAETS,IAAcH,EAAa,IAAIH,CAAa,KAA+B,QAC3EO,IAAYJ,EAAa,IAAIF,CAAU,MAAM,KAE7CO,IAASC,EAAM,YAAY,CAACC,GAA8BC,MAAyB;AACvF,UAAMC,IAAK,IAAI,gBAAgBT,EAAa,UAAU;AACtD,IAAIO,IAAcE,EAAG,IAAIZ,GAAe,OAAOU,CAAY,CAAC,IAAQE,EAAG,OAAOZ,CAAa,GAC3FY,EAAG,IAAIX,GAAYU,IAAc,MAAM,GAAG;AAC1C,UAAME,IAAKD,EAAG,SAAA,GACRE,IAAMD,IAAK,GAAGT,CAAQ,IAAIS,CAAE,KAAKT;AAEvC,KADYF,MAAW,SAASG,EAAO,OAAOA,EAAO,SACjDS,GAAK,EAAE,QAAQ,GAAA,CAAO;AAAA,EAC5B,GAAG,CAACX,GAAcC,GAAUC,GAAQH,GAAQF,GAAeC,CAAU,CAAC;AAEtE,SAAO;AAAA,IACL,YAAAK;AAAA,IACA,WAAAC;AAAA,IACA,eAAe,CAACQ,MAAuBP,EAAOO,GAAIR,CAAS;AAAA,IAC3D,cAAc,CAACS,MAAeR,EAAOF,GAAYU,CAAC;AAAA,EAAA;AAEtD;AClDO,SAASC,IAAoB;AACnC,SAAAC,EAAU,MAAM;AACf,QAAIC,IAAY;AAEhB,YAAC,YAAY;AACZ,UAAI;AAEH,cAAMC,IAAW,MAAM,OACtB,0CACD;AACA,YAAID,EAAW;AAIf,YAAIC,KAAO,OAAOA,EAAI,WAAY;AACjC,cAAI;AACH,YAAAA,EAAI,QAAQ,QAAQ;AAAA,UACrB,QAAQ;AAAA,UAAC;AAAA,MAEX,SAASC,GAAK;AACb,gBAAQ,MAAM,gDAAgDA,CAAG;AAAA,MAClE;AAAA,IACD,GAAA,GAEO,MAAM;AACZ,MAAAF,IAAY;AAAA,IACb;AAAA,EACD,GAAG,CAAA,CAAE,GAEE;AACR;AC5CO,SAASG,IAAiB;AAEhC,6CAAQL,GAAA,IAAkB;AAC3B;AAuBO,SAASM,IAAuB;AACtC,6CAAQN,GAAA,IAAkB;AAC3B;"}