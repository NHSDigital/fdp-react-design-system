// MetricCard (cleaned) â€“ uses SCSS token variables via nhs namespace
@use "../../../../../packages/nhs-fdp/scss" as nhs;

.fdp-metric-card {
	position: relative;
	/* Allow dynamic background via CSS var, fallback to token gradient/white */
	background: var(--fdp-metric-card-bg, nhs.$nhs-fdp-color-primary-white);
	border: 1px solid nhs.$nhs-fdp-border-color-card;
	border-radius: nhs.$nhs-fdp-border-radius-medium;
	box-shadow:
		0 1px 3px rgba(0, 0, 0, 0.06),
		0 1px 2px rgba(0, 0, 0, 0.08);
	overflow: hidden;
	transition:
		box-shadow 0.2s ease-in-out,
		border-color 0.2s ease-in-out;
	min-width: 0; // prevent overflow in flex/grid
	display: block;
	// Use design system font tokens so brands (e.g. FDP) can override via CSS variables
	font-family: #{nhs.$nhs-fdp-font-family-base}, #{nhs.$nhs-fdp-font-family-fallback};
	max-width: 300px;

	// Accent bar (variant colour) implemented with ::before to avoid extra markup
	&::before {
		content: "";
		position: absolute;
		inset: 0 auto 0 0;
		width: 4px;
		/* Accent can be overridden by CSS var for SPC-driven colour */
		background: var(--fdp-metric-card-accent, nhs.$nhs-fdp-color-grey-4); // default neutral accent
	}

	&:hover {
		box-shadow:
			0 4px 12px rgba(0, 0, 0, 0.1),
			0 2px 4px rgba(0, 0, 0, 0.08);
		border-color: nhs.$nhs-fdp-border-color-card-hover;
	}

	&:focus-within {
		outline: 2px solid nhs.$nhs-fdp-color-primary-blue;
		outline-offset: 2px;
	}

	/* Variants */
	&--primary {
		background: var(--fdp-metric-card-bg, nhs.$nhs-fdp-gradient-metric-card-primary);
		&::before {
			background: var(--fdp-metric-card-accent, nhs.$nhs-fdp-color-data-viz-categorical-1);
		}
	}
	&--secondary {
		background: var(--fdp-metric-card-bg, nhs.$nhs-fdp-gradient-metric-card-secondary);
		&::before {
			background: var(--fdp-metric-card-accent, nhs.$nhs-fdp-color-data-viz-categorical-10);
		}
	}
	&--accent {
		background: var(--fdp-metric-card-bg, nhs.$nhs-fdp-gradient-metric-card-accent);
		&::before {
			background: var(--fdp-metric-card-accent, nhs.$nhs-fdp-color-data-viz-categorical-6);
		}
	}
	&--success {
		background: var(--fdp-metric-card-bg, nhs.$nhs-fdp-gradient-metric-card-success);
		&::before {
			background: var(--fdp-metric-card-accent, nhs.$nhs-fdp-color-data-viz-categorical-3);
		}
	}
	&--warning {
		background: var(--fdp-metric-card-bg, nhs.$nhs-fdp-gradient-metric-card-warning);
		&::before {
			background: var(--fdp-metric-card-accent, nhs.$nhs-fdp-color-data-viz-categorical-7);
		}
	}
	&--error {
		background: var(--fdp-metric-card-bg, nhs.$nhs-fdp-gradient-metric-card-error);
		&::before {
			background: var(--fdp-metric-card-accent, nhs.$nhs-fdp-color-primary-red);
		}
	}

	/* Loading / error state cursors */
	&--loading {
		cursor: progress;
	}
	&--error {
		border-color: nhs.$nhs-fdp-color-primary-red;
	}

	/* Status driven delta colouring overrides */
	&--status-positive .fdp-metric-card__delta--up {
		color: nhs.$nhs-fdp-color-data-viz-categorical-3;
	}
	&--status-negative .fdp-metric-card__delta--down {
		color: nhs.$nhs-fdp-color-primary-red;
	}
	&--status-warning .fdp-metric-card__delta--down {
		color: nhs.$nhs-fdp-color-data-viz-categorical-7;
	}

	&__inner {
		padding: nhs.$nhs-fdp-spacing-4 nhs.$nhs-fdp-spacing-4
			nhs.$nhs-fdp-spacing-4 calc(nhs.$nhs-fdp-spacing-4 + 4px);
		display: flex;
		flex-direction: column;
		gap: nhs.$nhs-fdp-spacing-3;
		min-height: 100%;
	}

	&__header {
		display: flex;
		flex-direction: column;
		justify-content: space-between;
		align-items: flex-start;
		gap: var(--spacing-2, 8px);
		&__inner {
			padding: nhs.$nhs-fdp-spacing-4 nhs.$nhs-fdp-spacing-4
				nhs.$nhs-fdp-spacing-4 calc(nhs.$nhs-fdp-spacing-4 + 4px);
			display: flex;
			flex-direction: column;
			gap: nhs.$nhs-fdp-spacing-3;
			min-height: 100%;
		}
	}
	&__label {
		margin: 0;
		font-size: nhs.$nhs-fdp-font-size-16-desktop;
		line-height: nhs.$nhs-fdp-font-line-height-16-desktop;
		font-weight: nhs.$nhs-fdp-font-weight-bold;
		letter-spacing: 0.25px;
		color: nhs.$nhs-fdp-semantic-color-text-primary;
		overflow-wrap: anywhere;
	}
	&__metadata {
		font-size: nhs.$nhs-fdp-font-size-16-desktop;
		line-height: nhs.$nhs-fdp-font-line-height-16-desktop;
		color: nhs.$nhs-fdp-semantic-color-text-secondary; // fallback: no tertiary token yet
		white-space: nowrap;
	}

	&__content {
		display: flex;
		flex-direction: column;
		gap: nhs.$nhs-fdp-spacing-3;
		min-width: 0; // prevent overflow
	}

	&__visual {
		margin-top: nhs.$nhs-fdp-spacing-2;
		width: 100%;
		/* Ensure embedded SVGs/charts scale to container width */
		& > svg,
		& > canvas,
		& > div {
			max-width: 100%;
			display: block;
		}
	}
	&__value-section {
		display: flex;
		flex-direction: column;
		gap: nhs.$nhs-fdp-spacing-2;
		flex: 1 1 auto;
		min-width: 0;
	}

	&__value {
		display: flex;
		align-items: flex-end;
		gap: nhs.$nhs-fdp-spacing-1;
		flex-wrap: wrap;
	}
	&__number {
		font-size: nhs.$nhs-fdp-font-size-36-desktop;
		line-height: nhs.$nhs-fdp-font-line-height-36-mobile;
		font-weight: nhs.$nhs-fdp-font-weight-bold;
		color: nhs.$nhs-fdp-semantic-color-text-primary;
		overflow-wrap: anywhere;
	}
	&__unit {
		font-size: nhs.$nhs-fdp-font-size-19-desktop;
		line-height: nhs.$nhs-fdp-font-line-height-19-desktop;
		font-weight: nhs.$nhs-fdp-font-weight-normal;
		color: nhs.$nhs-fdp-semantic-color-text-secondary;
	}
	&__subtitle {
		font-size: nhs.$nhs-fdp-font-size-16-desktop;
		line-height: nhs.$nhs-fdp-font-line-height-16-desktop;
		color: nhs.$nhs-fdp-semantic-color-text-secondary;
	}

	&__delta-section {
		display: flex;
		flex-direction: column;
		gap: nhs.$nhs-fdp-spacing-1;
		align-items: flex-start;
		flex: 0 0 auto;
	}
	&__delta {
		display: inline-flex;
		align-items: center;
		gap: nhs.$nhs-fdp-spacing-1;
		font-size: nhs.$nhs-fdp-font-size-16-desktop;
		line-height: nhs.$nhs-fdp-font-line-height-16-desktop;
		font-weight: nhs.$nhs-fdp-font-weight-bold;
		color: nhs.$nhs-fdp-semantic-color-text-secondary;
	}
	&__delta--up {
		color: nhs.$nhs-fdp-color-data-viz-categorical-3;
	}
	&__delta--down {
		color: nhs.$nhs-fdp-color-data-viz-categorical-7;
	}
	&__delta--neutral {
		color: nhs.$nhs-fdp-color-grey-2;
	}
	&__delta-value {
		display: inline-flex;
		align-items: center;
		gap: 4px;
	}
	&__delta-period {
		font-size: nhs.$nhs-fdp-font-size-16-desktop;
		line-height: nhs.$nhs-fdp-font-line-height-16-desktop;
		font-weight: nhs.$nhs-fdp-font-weight-normal;
		color: nhs.$nhs-fdp-semantic-color-text-secondary;
	}

	&__skeleton {
		display: flex;
		flex-direction: column;
		gap: 8px;
	}
	&__skeleton-line {
		height: 12px;
		width: 100%;
		border-radius: 4px;
		background: linear-gradient(
			90deg,
			nhs.$nhs-fdp-color-grey-5 25%,
			nhs.$nhs-fdp-color-grey-4 50%,
			nhs.$nhs-fdp-color-grey-5 75%
		);
		background-size: 200% 100%;
		animation: fdp-metric-card-skel 1.4s ease-in-out infinite;
	}
	&__skeleton-line--value {
		height: 38px;
		width: 60%;
	}

	&__error {
		font-size: nhs.$nhs-fdp-font-size-14-mobile;
		line-height: nhs.$nhs-fdp-font-line-height-14-mobile;
		color: nhs.$nhs-fdp-color-primary-red;
		font-weight: nhs.$nhs-fdp-font-weight-bold;
	}

	/* Responsive */
	@media (min-width: nhs.$nhs-fdp-breakpoint-medium) {
		&__content {
			flex-direction: column;
			align-items: flex-start;
			justify-content: space-between;
		}
		&__delta-section {
			align-items: flex-end;
			text-align: right;
		}
		&__label {
			font-size: nhs.$nhs-fdp-font-size-16-desktop;
			line-height: nhs.$nhs-fdp-font-line-height-16-desktop;
		}
		&__metadata {
			font-size: nhs.$nhs-fdp-font-size-14-desktop;
			line-height: nhs.$nhs-fdp-font-line-height-14-desktop;
		}
		&__number {
			font-size: nhs.$nhs-fdp-font-size-48-desktop;
			line-height: nhs.$nhs-fdp-font-line-height-48-desktop;
		}
		&__unit {
			font-size: nhs.$nhs-fdp-font-size-22-desktop;
			line-height: nhs.$nhs-fdp-font-line-height-22-desktop;
		}
		&__subtitle {
			font-size: nhs.$nhs-fdp-font-size-14-desktop;
			line-height: nhs.$nhs-fdp-font-line-height-14-desktop;
		}
		&__delta {
			font-size: nhs.$nhs-fdp-font-size-14-desktop;
			line-height: nhs.$nhs-fdp-font-line-height-14-desktop;
		}
		&__delta-period {
			font-size: nhs.$nhs-fdp-font-size-14-desktop;
			line-height: nhs.$nhs-fdp-font-line-height-14-desktop;
		}
		&__error {
			font-size: nhs.$nhs-fdp-font-size-14-desktop;
			line-height: nhs.$nhs-fdp-font-line-height-14-desktop;
		}
	}
}

@keyframes fdp-metric-card-skel {
	0% {
		background-position: -200% 0;
	}
	100% {
		background-position: 200% 0;
	}
}

/* Visually hidden utility */
.fdp-visually-hidden {
	position: absolute !important;
	width: 1px !important;
	height: 1px !important;
	padding: 0 !important;
	margin: -1px !important;
	overflow: hidden !important;
	clip: rect(0 0 0 0) !important;
	white-space: nowrap !important;
	border: 0 !important;
}
