// NHS Header SCSS - Uses compiled design tokens
@use '../../../packages/nhs-fdp/scss' as nhs;

// Header variables
$header-item-padding: nhs.$nhs-fdp-spacing-3;
$header-link-padding: nhs.$nhs-fdp-spacing-1;
$header-item-hover-color: nhs.$nhs-fdp-semantic-color-hover-header-link; // Slightly lighter than NHS Blue
$header-item-active-color: nhs.$nhs-fdp-semantic-color-active-header-link; // Darker than NHS Blue
$header-item-active-size: nhs.$nhs-fdp-focus-outline-width;

// Header link styling mixin
@mixin header-link-style(
  $link-color: nhs.$nhs-fdp-semantic-color-link-default,
  $link-hover-color: $header-item-hover-color,
  $link-active-color: $header-item-active-color
) {
  color: $link-color;
  text-decoration: none;

  &:hover {
	color: $link-hover-color;
  }

  &:active {
	color: $link-active-color;
  }

  &:focus {
	outline: nhs.$nhs-fdp-focus-outline-width nhs.$nhs-fdp-focus-outline-style nhs.$nhs-fdp-semantic-color-focus-background;
	outline-offset: 0;
	background-color: nhs.$nhs-fdp-semantic-color-focus-background;
	color: nhs.$nhs-fdp-semantic-color-focus-text;
	box-shadow: inset 0 -#{nhs.$nhs-fdp-focus-outline-width} nhs.$nhs-fdp-semantic-color-focus-text;
  }

  &:focus:visited {
	color: nhs.$nhs-fdp-semantic-color-focus-text;
  }
}

// Mobile menu toggle in header container (main positioning)
.nhsuk-header__mobile-menu {
  @media (max-width: calc(#{nhs.$nhs-fdp-breakpoint-small-max})) {
	display: flex;
	align-items: center;
	margin-left: auto; // Push to right side of header
	order: 999;
  }

  @media (min-width: nhs.$nhs-fdp-breakpoint-medium) {
	display: none;
  }

  .nhsuk-header__menu-toggle {
	background: transparent;
	border: 0;
	border-radius: 0;
	color: nhs.$nhs-fdp-color-primary-white;
	cursor: pointer;
	display: flex;
	align-items: center;
	gap: nhs.$nhs-fdp-spacing-2;
	font-family: #{nhs.$nhs-fdp-font-family-base}, #{nhs.$nhs-fdp-font-family-fallback};
	font-size: nhs.$nhs-fdp-font-size-16-mobile;
	font-weight: nhs.$nhs-fdp-font-weight-normal;
	padding: nhs.$nhs-fdp-spacing-2 0;

	@media (min-width: nhs.$nhs-fdp-breakpoint-medium) {
	  font-size: nhs.$nhs-fdp-font-size-16-tablet;
	}

	&:focus {
	  outline: nhs.$nhs-fdp-focus-outline-width nhs.$nhs-fdp-focus-outline-style nhs.$nhs-fdp-semantic-color-focus-background;
	  outline-offset: 0;
	  background-color: nhs.$nhs-fdp-semantic-color-focus-background;
	  color: nhs.$nhs-fdp-semantic-color-focus-text;
	}

	&:hover {
	  color: nhs.$nhs-fdp-color-primary-white;
	  text-decoration: underline;
	}

	.nhsuk-header__menu-toggle-text {
	  display: inline-block;
	}

	.nhsuk-header__menu-toggle-icon {
	  display: flex;
	  align-items: center;
	}

	.nhsuk-icon__menu,
	.nhsuk-icon__close {
	  width: nhs.$nhs-fdp-spacing-6;
	  height: nhs.$nhs-fdp-spacing-6;
	  fill: currentColor;
	}
  }
}

// Main header component
.nhsuk-header {
  background-color: nhs.$nhs-fdp-color-primary-blue;
  color: nhs.$nhs-fdp-color-primary-white;
  font-family: #{nhs.$nhs-fdp-font-family-base}, #{nhs.$nhs-fdp-font-family-fallback};

  // Add shadow to bottom of header when menu is open
  &:has(.nhsuk-header__menu-list:not([hidden])) {
	border-bottom: nhs.$nhs-fdp-spacing-2 solid nhs.$nhs-fdp-color-grey-4;
  }
}

.nhsuk-header__container {
  padding: nhs.$nhs-fdp-spacing-4 0;
  margin: 0 nhs.$nhs-fdp-spacing-7;
  
  @media (max-width: calc(#{nhs.$nhs-fdp-breakpoint-medium} - 1px)) {
	margin: 0 nhs.$nhs-fdp-spacing-4;
	padding: nhs.$nhs-fdp-spacing-3 0;
	display: flex;
	flex-wrap: wrap;
	align-items: center;
	gap: nhs.$nhs-fdp-spacing-4;
  }
  
  @media (min-width: nhs.$nhs-fdp-breakpoint-medium) {
	display: flex;
	flex-flow: row wrap;
	gap: nhs.$nhs-fdp-spacing-4;
  }
}

// Service logo and name
.nhsuk-header__logo {
  min-width: nhs.$nhs-fdp-component-header-logo-min-width;
}

.nhsuk-header__service,
.nhsuk-header__service-logo {
  gap: nhs.$nhs-fdp-spacing-3 nhs.$nhs-fdp-spacing-4;
  margin-right: auto;
}

.nhsuk-header__service {
  display: flex;

  @media (min-width: nhs.$nhs-fdp-breakpoint-medium) {
	flex-grow: 999;
  }
}

.nhsuk-header__service-name {
  display: inline-flex;
  flex-direction: column;
  flex-grow: 0;
  justify-content: center;
  margin-right: auto;
  text-wrap: balance;
  max-width: 54ch;
  font-size: nhs.$nhs-fdp-font-size-19-mobile;
  font-weight: nhs.$nhs-fdp-font-weight-normal;
  line-height: 1.1;

  @media (min-width: nhs.$nhs-fdp-breakpoint-medium) {
	font-size: nhs.$nhs-fdp-font-size-19-tablet;
  }

  @media (max-width: calc(#{nhs.$nhs-fdp-breakpoint-medium} - 1px)) {
	max-width: 14ch;
  }

  &:only-child {
	display: block;
  }
}

.nhsuk-header__service-logo {
  position: relative;
  display: inline-flex;
  flex-grow: 0;
  line-height: 0;
  margin-right: 0;
  text-decoration: none;

  &:only-child {
	display: flex;
  }

  // Add SVG logo underline on hover
  &:has(svg):not(:focus):hover::before {
	content: "";
	border-bottom: 0.1rem solid currentcolor;
	display: inline;
	height: nhs.$nhs-fdp-component-header-logo-height;
	position: absolute;
	top: 0.2rem;
	width: nhs.$nhs-fdp-component-header-logo-min-width;
  }
}

.nhsuk-header__service-logo,
.nhsuk-header__service-name[href],
.nhsuk-header__account-button,
.nhsuk-header__account-link {
  @include header-link-style(
	$link-color: nhs.$nhs-fdp-color-primary-white,
	$link-hover-color: nhs.$nhs-fdp-color-primary-white,
	$link-active-color: nhs.$nhs-fdp-color-primary-white
  );
}

// Account section
.nhsuk-header__account {
  background-color: #3a71a6; // Slightly lighter blue for contrast
  border: 1px solid #3a71a6;
  border-radius: nhs.$nhs-fdp-border-radius-small;
  flex-grow: 1;
  margin-top: nhs.$nhs-fdp-spacing-4;
  overflow: hidden;

  .nhsuk-icon__user {
	fill: currentcolor;
	height: nhs.$nhs-fdp-component-header-search-icon-size;
	width: nhs.$nhs-fdp-component-header-search-icon-size;
	flex-shrink: 0;
  }

  @media (min-width: nhs.$nhs-fdp-breakpoint-medium) {
	align-self: start;
	margin: nhs.$nhs-fdp-layout-margin-negative-thin;
  }
}

.nhsuk-header__account-list {
  position: relative;
  display: flex;
  flex-wrap: wrap;
  gap: nhs.$nhs-fdp-layout-gap-minimal;
  list-style: none;
  margin: 0;
  overflow: hidden;
  padding: 0;
}

.nhsuk-header__account-item {
  display: flex;
  flex-grow: 1;
  gap: nhs.$nhs-fdp-spacing-3;
  margin: 0;
  outline: 1px solid nhs.$nhs-fdp-color-primary-blue;
  overflow-wrap: anywhere;
  padding: nhs.$nhs-fdp-spacing-3 $header-item-padding;
  font-size: nhs.$nhs-fdp-font-size-16-mobile;
  font-weight: nhs.$nhs-fdp-font-weight-normal;

  @media (min-width: nhs.$nhs-fdp-breakpoint-medium) {
	font-size: nhs.$nhs-fdp-font-size-16-tablet;
  }

  &:nth-last-child(2) {
	margin-right: auto;
  }

  &:last-child {
	flex-grow: 0;
  }
}

.nhsuk-header__account-button,
.nhsuk-header__account-link {
  display: flex;
  gap: nhs.$nhs-fdp-spacing-3;
  margin: -#{nhs.$nhs-fdp-spacing-3} -#{$header-item-padding};
  padding: nhs.$nhs-fdp-spacing-3 $header-item-padding;
  overflow-wrap: anywhere;
}

.nhsuk-header__account-button {
  background: none;
  border: 0;
  cursor: pointer;
  text-decoration: underline;
  font-family: #{nhs.$nhs-fdp-font-family-base}, #{nhs.$nhs-fdp-font-family-fallback};
  font-size: nhs.$nhs-fdp-font-size-16-mobile;
  font-weight: nhs.$nhs-fdp-font-weight-normal;

  @media (min-width: nhs.$nhs-fdp-breakpoint-medium) {
	font-size: nhs.$nhs-fdp-font-size-16-tablet;
  }
}

// Search section
.nhsuk-header__search {
  flex-grow: 1;
  margin-top: nhs.$nhs-fdp-spacing-4;
  position: relative;
  z-index: 10;

  @media (min-width: nhs.$nhs-fdp-breakpoint-medium) {
	margin: 0;
  }

  .nhsuk-icon__search {
	height: 28px;
	width: 28px;
	margin: 0 -2px -2px 0;
  }
}

.nhsuk-header__search-form {
  display: flex;
  height: 100%;
  overflow: visible;
}

.nhsuk-header__search-input.nhsuk-input {
  border-color: transparent;
  border-radius: nhs.$nhs-fdp-border-radius-small 0 0 nhs.$nhs-fdp-border-radius-small;
  height: 40px;
  margin-right: -#{nhs.$nhs-fdp-border-width-form-element};
  padding-right: $header-item-padding;
  padding-left: $header-item-padding - nhs.$nhs-fdp-border-width-form-element;
  width: 100%;
  font-size: nhs.$nhs-fdp-font-size-16-mobile;
  font-weight: nhs.$nhs-fdp-font-weight-normal;

  @media (min-width: nhs.$nhs-fdp-breakpoint-medium) {
	font-size: nhs.$nhs-fdp-font-size-16-tablet;
  }

  &:focus {
	z-index: 10;
  }

  &::placeholder {
	color: nhs.$nhs-fdp-color-grey-1;
	opacity: 1;
  }

  // Hide search input clear button (IE)
  &::-ms-clear {
	display: none;
  }

  // Hide search input icon and cancel button (WebKit, Blink)
  &::-webkit-search-decoration,
  &::-webkit-search-cancel-button {
	appearance: none;
  }
}

.nhsuk-header__search-submit {
  background-color: nhs.$nhs-fdp-color-grey-5;
  border: 0;
  border-radius: 0 nhs.$nhs-fdp-border-radius-small nhs.$nhs-fdp-border-radius-small 0;
  color: nhs.$nhs-fdp-color-primary-blue;
  flex-shrink: 0;
  height: 40px; // Match input field height exactly
  line-height: 1;
  margin: 0;
  width: 44px;
  cursor: pointer;

  &:hover,
  &:active {
	background-color: $header-item-hover-color;
	box-shadow: inset 0 0 0 1px nhs.$nhs-fdp-color-primary-white;
	color: nhs.$nhs-fdp-color-primary-white;
  }

  &:active {
	background-color: $header-item-active-color;
  }

  &:focus {
	outline: nhs.$nhs-fdp-focus-outline-width nhs.$nhs-fdp-focus-outline-style nhs.$nhs-fdp-semantic-color-focus-background;
	outline-offset: 0;
	background-color: nhs.$nhs-fdp-semantic-color-focus-background;
	color: nhs.$nhs-fdp-semantic-color-focus-text;
  }
}

// Navigation
.nhsuk-header__navigation {
  background-color: nhs.$nhs-fdp-color-primary-blue;
  border: 0 solid nhs.$nhs-fdp-color-primary-white;
  color: nhs.$nhs-fdp-color-primary-white;
  margin: 0 nhs.$nhs-fdp-spacing-7;

  @media (max-width: calc(#{nhs.$nhs-fdp-breakpoint-medium} - 1px)) {
	margin: 0 nhs.$nhs-fdp-spacing-4;
	
	// On mobile, hide the main navigation list by default
	.nhsuk-header__navigation-list {
	  display: none;
	}
	
	// But show the menu toggle
	.nhsuk-header__menu {
	  display: block !important;
	}
  }
}

.nhsuk-header__navigation-list {
  position: relative;
  display: flex;
  flex-wrap: wrap;
  list-style: none;
  margin: 0 -#{nhs.$nhs-fdp-spacing-2};
  padding: 0;
  width: calc(100% + #{nhs.$nhs-fdp-spacing-4});

  @media (min-width: nhs.$nhs-fdp-breakpoint-medium) {
	width: calc(100% + #{nhs.$nhs-fdp-spacing-6});
	margin: 0 -#{nhs.$nhs-fdp-spacing-3};
  }

  .nhsuk-header__navigation--justified & {
	@media (min-width: nhs.$nhs-fdp-breakpoint-xlarge) {
	  justify-content: space-between;
	}
  }

  .nhsuk-frontend-supported & {
	flex-wrap: nowrap;

	@media (max-width: calc(#{nhs.$nhs-fdp-breakpoint-medium} - 1px)) {
	  flex-wrap: wrap;
	}
  }
}

.nhsuk-header__navigation-item {
  margin-bottom: 0;
  padding: 0 nhs.$nhs-fdp-spacing-2;

  @media (min-width: nhs.$nhs-fdp-breakpoint-medium) {
	padding: 0 nhs.$nhs-fdp-spacing-3;
  }
}

.nhsuk-header__navigation-item-current-fallback {
  font-weight: inherit;
}

.nhsuk-header__navigation-link {
  display: block;
  padding: nhs.$nhs-fdp-spacing-4 $header-link-padding;
  position: relative;
  white-space: nowrap;
  font-size: nhs.$nhs-fdp-font-size-16-mobile;
  font-weight: nhs.$nhs-fdp-font-weight-normal;

  @include header-link-style(
	$link-color: nhs.$nhs-fdp-color-primary-white,
	$link-hover-color: nhs.$nhs-fdp-color-primary-white,
	$link-active-color: nhs.$nhs-fdp-color-primary-white
  );

  @media (min-width: nhs.$nhs-fdp-breakpoint-medium) {
	font-size: nhs.$nhs-fdp-font-size-16-tablet;
  }

  // Visual indicator for navigation item uses a border on bottom edge
  &::before {
	content: "";
	display: block;
	position: absolute;
	bottom: 0;
	left: 0;
	right: 0;
	border: 0 solid currentcolor;
  }

  // Visual indicator for current navigation
  &[aria-current="page"]::before,
  &[aria-current="true"]::before {
	border-bottom-width: $header-item-active-size;
  }
}

// Menu (responsive dropdown)
.nhsuk-header__menu {
  align-self: center;
  padding: 0 nhs.$nhs-fdp-spacing-2;

  &[hidden] {
	display: none;
  }

  @media (min-width: nhs.$nhs-fdp-breakpoint-medium) {
	padding: 0 nhs.$nhs-fdp-spacing-3;
  }

  @media (max-width: calc(#{nhs.$nhs-fdp-breakpoint-medium} - 1px)) {
	// On mobile, always show the menu toggle if there are nav items
	display: block !important;
	order: 999; // Push to end of container
	margin-left: auto;
	
	// Make sure the toggle is visible even when parent list is hidden
	&[hidden] {
	  display: block !important;
	}
  }
}

.nhsuk-header__menu-toggle {
  align-items: center;
  background: transparent;
  border: 0;
  border-radius: 0;
  box-sizing: border-box;
  cursor: pointer;
  display: flex;
  margin: 0;
  text-align: center;
  vertical-align: top;
  color: nhs.$nhs-fdp-color-primary-white;
  gap: nhs.$nhs-fdp-spacing-2;
  font-family: #{nhs.$nhs-fdp-font-family-base}, #{nhs.$nhs-fdp-font-family-fallback};
  font-size: nhs.$nhs-fdp-font-size-16-mobile;
  font-weight: nhs.$nhs-fdp-font-weight-normal;
  padding: nhs.$nhs-fdp-spacing-4 $header-link-padding;

  @media (min-width: nhs.$nhs-fdp-breakpoint-medium) {
	font-size: nhs.$nhs-fdp-font-size-16-tablet;
  }

  &[hidden] {
	display: none;
  }

  &:focus {
	outline: nhs.$nhs-fdp-focus-outline-width nhs.$nhs-fdp-focus-outline-style nhs.$nhs-fdp-semantic-color-focus-background;
	outline-offset: 0;
	background-color: nhs.$nhs-fdp-semantic-color-focus-background;
	color: nhs.$nhs-fdp-semantic-color-focus-text;
	box-shadow: inset 0 -#{nhs.$nhs-fdp-focus-outline-width} nhs.$nhs-fdp-semantic-color-focus-text;
  }

  &:hover {
	color: nhs.$nhs-fdp-color-primary-white;
	text-decoration: none;
  }

  &:active {
	color: nhs.$nhs-fdp-color-primary-white;
  }

  .nhsuk-header__menu-toggle-text {
	font-size: nhs.$nhs-fdp-font-size-16-mobile;
	font-weight: nhs.$nhs-fdp-font-weight-normal;

	@media (min-width: nhs.$nhs-fdp-breakpoint-medium) {
	  font-size: nhs.$nhs-fdp-font-size-16-tablet;
	}
  }

  .nhsuk-header__menu-toggle-icon {
	display: flex;
	align-items: center;
  }

  .nhsuk-icon__menu,
  .nhsuk-icon__close {
	width: nhs.$nhs-fdp-spacing-6;
	height: nhs.$nhs-fdp-spacing-6;
	fill: currentColor;
  }

  .nhsuk-icon__chevron-down {
	width: nhs.$nhs-fdp-spacing-4;
	height: nhs.$nhs-fdp-spacing-4;
	transform: rotate(90deg);
	fill: currentColor;
	// Move icon to align with edge of button, offsetting 8px of empty
	// SVG view box but keeping the same 2px padding used by text links
	margin-right: -8px + $header-link-padding;
  }

  &[aria-expanded="true"] .nhsuk-icon__chevron-down {
	transform: rotate(270deg);
  }
}

.nhsuk-header__menu-list {
  list-style: none;
  margin: 0 nhs.$nhs-fdp-spacing-2;
  padding: 0;
  position: absolute;
  right: 0;
  top: 100%;
  left: 0;
  background-color: nhs.$nhs-fdp-color-primary-white;
  z-index: 100;

  @media (min-width: nhs.$nhs-fdp-breakpoint-medium) {
	margin: 0 nhs.$nhs-fdp-spacing-3;
  }

  &[hidden] {
	display: none;
  }

  @media (max-width: calc(#{nhs.$nhs-fdp-breakpoint-medium} - 1px)) {
	// Mobile styles for dropdown menu - position absolute to navigation container
	position: absolute;
	top: 100%;
	left: 0;
	right: 0;
	margin: 0;
	border-top: 1px solid rgba(255, 255, 255, 0.2);
	width: 100%;
	// Extend to full width of viewport
	margin-left: -#{nhs.$nhs-fdp-spacing-4};
	margin-right: -#{nhs.$nhs-fdp-spacing-4};
	padding-left: nhs.$nhs-fdp-spacing-4;
	padding-right: nhs.$nhs-fdp-spacing-4;
	box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  .nhsuk-header__navigation-link {
	@include header-link-style;

	@media (max-width: calc(#{nhs.$nhs-fdp-breakpoint-medium} - 1px)) {
	  padding: nhs.$nhs-fdp-spacing-4 0;
	  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
	  display: block;
	}

	// Visual indicator for navigation item uses a border on left edge in dropdown
	&[aria-current="page"]::before,
	&[aria-current="true"]::before {
	  width: 0;
	  top: 0;
	  bottom: 0;
	  left: -#{nhs.$nhs-fdp-spacing-3};
	  right: auto;
	  border-left-width: $header-item-active-size;
	  border-bottom-width: 0;

	  @media (min-width: nhs.$nhs-fdp-breakpoint-xlarge) {
		left: -#{nhs.$nhs-fdp-spacing-4};
	  }

	  @media (max-width: calc(#{nhs.$nhs-fdp-breakpoint-medium} - 1px)) {
		left: -#{nhs.$nhs-fdp-spacing-4};
		border-left-width: $header-item-active-size;
	  }
	}
  }

  .nhsuk-header__navigation-item {
	padding: 0;
	border-bottom: 1px solid nhs.$nhs-fdp-color-grey-5;

	@media (max-width: calc(#{nhs.$nhs-fdp-breakpoint-medium} - 1px)) {
	  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
	}

	&:last-child {
	  border: 0;
	}
  }
}

// White header navigation variant
.nhsuk-header__navigation--white {
  background-color: nhs.$nhs-fdp-color-primary-white;
  color: nhs.$nhs-fdp-color-primary-blue;

  .nhsuk-header__navigation-link {
	@include header-link-style;
  }

  .nhsuk-header__menu-list {
	border-top: 1px solid nhs.$nhs-fdp-color-grey-5;
  }
}

// Navigation container styles
.nhsuk-header__navigation-container {
  box-shadow: 0 -0.25px 0 0 nhs.$nhs-fdp-border-color-default;
  position: relative;

  @media (max-width: calc(#{nhs.$nhs-fdp-breakpoint-medium} - 1px)) {
	// On mobile, remove box shadow and add better spacing
	box-shadow: none;
	margin-top: 0;
  }

  .nhsuk-header--white .nhsuk-header__navigation--white & {
	box-shadow: 0 -1px 0 0 nhs.$nhs-fdp-color-grey-4;
  }

  .nhsuk-header--white :not(.nhsuk-header__navigation--white) &,
  .nhsuk-header__navigation--white & {
	box-shadow: none;
	margin-top: 0;
  }

  &,
  .nhsuk-header--white .nhsuk-header__navigation--white & {
	@media (max-width: calc(#{nhs.$nhs-fdp-breakpoint-medium} - 1px)) {
	  box-shadow: none;
	  margin-top: -#{nhs.$nhs-fdp-spacing-3};
	}
  }
}

// White header variant
.nhsuk-header--white {
  background-color: nhs.$nhs-fdp-color-primary-white;
  color: nhs.$nhs-fdp-color-primary-blue;

  .nhsuk-header__service-logo,
  .nhsuk-header__service-name[href],
  .nhsuk-header__account-button,
  .nhsuk-header__account-link {
	@include header-link-style;
  }

  .nhsuk-header__service-logo:not(:focus):not(:hover) .nhsuk-header__organisation-name {
	color: nhs.$nhs-fdp-color-primary-black;
  }

  .nhsuk-header__account {
	background-color: nhs.$nhs-fdp-color-grey-5;
	border-color: nhs.$nhs-fdp-color-grey-4;
  }

  .nhsuk-header__account-item {
	outline-color: nhs.$nhs-fdp-color-grey-4;
  }

  .nhsuk-header__search-input.nhsuk-input:not(:focus) {
	margin-right: -1px;
	padding-left: $header-item-padding - 1px;
	border-color: nhs.$nhs-fdp-color-grey-3;
	border-width: 1px;
  }

  .nhsuk-header__search-submit {
	background-color: nhs.$nhs-fdp-color-primary-blue;
	color: nhs.$nhs-fdp-color-primary-white;

	&:hover,
	&:active {
	  background-color: $header-item-hover-color;
	  border-color: $header-item-hover-color;
	  box-shadow: none;
	}

	&:active {
	  background-color: $header-item-active-color;
	}
  }
}

// Organisation header variant
.nhsuk-header--organisation {
  .nhsuk-header__logo {
	height: 24px;
	margin-bottom: 6px;
	min-width: auto;
	width: 60px;

	@media (min-width: nhs.$nhs-fdp-breakpoint-medium) {
	  height: 32px;
	  width: 80px;
	}
  }

  .nhsuk-header__service-logo {
	display: block;

	// Adjust SVG logo underline position
	&:has(svg):not(:focus):hover::before {
	  height: 24px;
	  width: 60px;

	  @media (min-width: nhs.$nhs-fdp-breakpoint-medium) {
		height: 32px;
		width: 80px;
	  }
	}
  }
}

.nhsuk-header__organisation-name {
  display: block;
  font-size: nhs.$nhs-fdp-font-size-22-mobile;
  font-weight: nhs.$nhs-fdp-font-weight-bold;
  line-height: 1.1;

  @media (min-width: nhs.$nhs-fdp-breakpoint-medium) {
	font-size: nhs.$nhs-fdp-font-size-22-tablet;
  }
}

.nhsuk-header__organisation-name-split {
  display: block;
}

.nhsuk-header__organisation-name-descriptor {
  display: block;
  font-size: nhs.$nhs-fdp-font-size-14-mobile;
  font-weight: nhs.$nhs-fdp-font-weight-bold;

  @media (min-width: nhs.$nhs-fdp-breakpoint-medium) {
	font-size: nhs.$nhs-fdp-font-size-14-tablet;
  }
}

.nhsuk-header__organisation-logo {
  border: 0;
  height: auto;
  width: 280px;

  @media (max-width: 450px) {
	max-width: 150px;
  }

  &[src$=".svg"] {
	max-width: 220px;
	width: 220px;
  }
}

// Remove service name underline
.nhsuk-header .nhsuk-header__service-name[href] {
  text-decoration: none;
}

// Add service logo underline on hover
.nhsuk-header .nhsuk-header__service-logo:not(:focus):hover,
.nhsuk-header .nhsuk-header__service-logo:not(:focus):hover .nhsuk-header__service-name,
.nhsuk-header .nhsuk-header__service-name[href]:not(:focus):hover {
  text-decoration: underline;
}

// Add service logo box shadow on focus
.nhsuk-header .nhsuk-header__service-logo:focus {
  outline: nhs.$nhs-fdp-focus-outline-width nhs.$nhs-fdp-focus-outline-style nhs.$nhs-fdp-semantic-color-focus-background;
  outline-offset: 0;
  background-color: nhs.$nhs-fdp-semantic-color-focus-background;
  color: nhs.$nhs-fdp-semantic-color-focus-text;
}

// Overflow navigation styles
.nhsuk-header__navigation-item--more {
  position: relative;

  @media (max-width: calc(#{nhs.$nhs-fdp-breakpoint-medium} - 1px)) {
	display: none; // Hide on mobile as all items show in mobile menu
  }
}

.nhsuk-header__navigation-button {
  @include header-link-style(
	$link-color: nhs.$nhs-fdp-color-primary-white,
	$link-hover-color: nhs.$nhs-fdp-color-primary-white,
	$link-active-color: nhs.$nhs-fdp-color-primary-white
  );
  background: transparent;
  border: none;
  cursor: pointer;
  padding: nhs.$nhs-fdp-spacing-4 $header-link-padding;
  font-family: inherit;
  font-size: nhs.$nhs-fdp-font-size-16-mobile;
  font-weight: nhs.$nhs-fdp-font-weight-normal;
  line-height: inherit;
  display: flex;
  align-items: center;
  gap: nhs.$nhs-fdp-spacing-1;
  white-space: nowrap;
  color: nhs.$nhs-fdp-color-primary-white;
  text-decoration: none;

  &:hover {
	color: nhs.$nhs-fdp-color-primary-white;
	text-decoration: none;
  }

  &:focus {
	outline: nhs.$nhs-fdp-focus-outline-width nhs.$nhs-fdp-focus-outline-style nhs.$nhs-fdp-semantic-color-focus-background;
	outline-offset: 0;
	background-color: nhs.$nhs-fdp-semantic-color-focus-background;
	color: nhs.$nhs-fdp-semantic-color-focus-text;
	box-shadow: inset 0 -#{nhs.$nhs-fdp-focus-outline-width} nhs.$nhs-fdp-semantic-color-focus-text;
  }

  .nhsuk-icon__chevron-down {
	width: nhs.$nhs-fdp-spacing-4;
	height: nhs.$nhs-fdp-spacing-4;
	transform: rotate(90deg); // Point down initially
	fill: currentColor;
	transition: transform 0.2s ease;
  }

  &[aria-expanded="true"] .nhsuk-icon__chevron-down {
	transform: rotate(270deg); // Point up when open
  }

  @media (min-width: nhs.$nhs-fdp-breakpoint-medium) {
			font-size: nhs.$nhs-fdp-font-size-16-tablet;
	}
}

.nhsuk-header__dropdown-menu {
  position: absolute;
  top: 100%;
  right: 0;
  min-width: 200px;
  background-color: nhs.$nhs-fdp-color-primary-white;
  border: 1px solid rgba(0, 0, 0, 0.15);
  border-radius: 0;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
  list-style: none;
  margin: 0;
  padding: 0;
  z-index: 1000;

  @media (max-width: calc(#{nhs.$nhs-fdp-breakpoint-medium} - 1px)) {
	display: none; // Hide on mobile as all items show in mobile menu
  }
}

.nhsuk-header__dropdown-item {
  margin: 0;
  
  &:first-child .nhsuk-header__dropdown-link {
	border-top: none;
  }
  
  &:last-child .nhsuk-header__dropdown-link {
	border-bottom: none;
  }
}

.nhsuk-header__dropdown-link {
  @include header-link-style(
	$link-color: nhs.$nhs-fdp-color-primary-blue,
	$link-hover-color: nhs.$nhs-fdp-color-primary-blue,
	$link-active-color: nhs.$nhs-fdp-color-primary-blue
  );
  display: block;
  padding: nhs.$nhs-fdp-spacing-3 nhs.$nhs-fdp-spacing-4;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  white-space: nowrap;
  
  &:hover {
	background-color: rgba(0, 0, 0, 0.05);
  }

  // Active/current state styling for dropdown items
  &[aria-current="page"],
  &[aria-current="true"] {
	background-color: rgba(0, 0, 0, 0.05);
	position: relative;
	
	&::before {
	  content: "";
	  position: absolute;
	  left: 0;
	  top: 0;
	  bottom: 0;
	  width: $header-item-active-size;
	  background-color: nhs.$nhs-fdp-color-primary-blue;
	}
  }
}

// Ensure dropdown items with current state show properly
.nhsuk-header__dropdown-item--current .nhsuk-header__dropdown-link {
  background-color: rgba(0, 0, 0, 0.05);
  position: relative;
  
  &::before {
	content: "";
	position: absolute;
	left: 0;
	top: 0;
	bottom: 0;
	width: $header-item-active-size;
	background-color: nhs.$nhs-fdp-color-primary-blue;
  }
}
