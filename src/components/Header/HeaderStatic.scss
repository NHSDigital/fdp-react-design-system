/* HeaderStatic.scss - True SSR-Compatible Header Styles
 * 
 * This stylesheet provides CSS-only responsive behavior for the HeaderStatic component.
 * Key features:
 * 1. No JavaScript required for responsive behaviour    // Dropdown menu (cleaner design matching NHS standards)
    .nhsuk-header__navigation-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      min-width: $header-static-dropdown-min-width;
      background: nhs.$nhs-fdp-color-primary-white;
      border: 1px solid nhs.$nhs-fdp-color-grey-4;
      border-radius: $header-static-border-radius;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      margin: 0;
      margin-top: 2px;
      padding: 0;
      list-style: none;
      z-index: $header-static-dropdown-z-index;
      
      // Hide by default (details will handle showing)
      display: block;
    } dropdown using <details> element
 * 3. Media query based responsive navigation
 * 4. Works without any client-side hydration
 * 5. Full integration with NHS FDP design tokens
 */

@use '../../../packages/nhs-fdp/scss' as nhs;

// Import NHS Header variables and mixins to match styling
$header-item-padding: nhs.$nhs-fdp-spacing-3;
$header-link-padding: nhs.$nhs-fdp-spacing-1;
$header-item-hover-color: nhs.$nhs-fdp-semantic-color-hover-header-link;
$header-item-active-color: nhs.$nhs-fdp-semantic-color-active-header-link;
$header-item-active-size: nhs.$nhs-fdp-focus-outline-width;

// Header link styling mixin (matching Header.scss)
@mixin header-link-style(
  $link-color: nhs.$nhs-fdp-semantic-color-link-default,
  $link-hover-color: $header-item-hover-color,
  $link-active-color: $header-item-active-color
) {
  color: $link-color;
  text-decoration: none;

  &:hover {
    color: $link-hover-color;
  }

  &:active {
    color: $link-active-color;
  }

  &:focus {
    outline: nhs.$nhs-fdp-focus-outline-width nhs.$nhs-fdp-focus-outline-style nhs.$nhs-fdp-semantic-color-focus-background;
    outline-offset: 0;
    background-color: nhs.$nhs-fdp-semantic-color-focus-background;
    color: nhs.$nhs-fdp-semantic-color-focus-text;
    box-shadow: inset 0 -#{nhs.$nhs-fdp-focus-outline-width} nhs.$nhs-fdp-semantic-color-focus-text;
  }

  &:focus:visited {
    color: nhs.$nhs-fdp-semantic-color-focus-text;
  }
}

// HeaderStatic-specific variables using NHS design tokens
$header-static-border-radius: nhs.$nhs-fdp-border-radius-small;
$header-static-dropdown-min-width: 200px;
$header-static-dropdown-z-index: 1000;

.nhsuk-header {
  &--static {
    // Static header identifier for debugging
    position: relative; // Ensure proper stacking context
    
    // Ensure consistent font family
    font-family: #{nhs.$nhs-fdp-font-family-base}, #{nhs.$nhs-fdp-font-family-fallback};
  }

  &__navigation {
    &--static {
      // Match the main navigation background color
      background-color: nhs.$nhs-fdp-color-primary-blue;
    }

    // Static navigation container
    &-container {
      &--static {
        position: relative; // Ensure proper positioning for dropdowns
      }
    }

    // Primary navigation list - always visible items
    &-list {
      &--primary {
        display: flex;
        flex-wrap: nowrap;
        align-items: center;
        margin: 0;
        padding: 0;
        list-style: none;
        gap: nhs.$nhs-fdp-spacing-2;
        
        @media (max-width: calc(#{nhs.$nhs-fdp-breakpoint-small-max})) {
          flex-direction: column;
          align-items: stretch;
          gap: 0;
        }
      }
    }

    // Navigation items
    &-item {
      // Primary navigation items (matching Header.scss structure)
      &--primary {
        margin-bottom: 0;
        padding: 0 nhs.$nhs-fdp-spacing-2;
        flex-shrink: 0;
        
        @media (min-width: nhs.$nhs-fdp-breakpoint-medium) {
          padding: 0 nhs.$nhs-fdp-spacing-3;
          
          &:last-child:not(.nhsuk-header__navigation-item--more) {
            margin-right: 0;
          }
        }
        
        @media (max-width: calc(#{nhs.$nhs-fdp-breakpoint-small-max})) {
          padding: 0;
          width: 100%;
          border-bottom: 1px solid rgba(255, 255, 255, 0.2); // Subtle separator on mobile
          
          &:last-child {
            border-bottom: none;
          }
        }

        // Current/active navigation item (matching Header.scss pattern)
        &.nhsuk-header__navigation-item--current {
          .nhsuk-header__navigation-link {
            &::before {
              border-bottom-width: $header-item-active-size;
            }
          }
        }
      }

      // "More" dropdown item - CSS-only implementation
      &--more {
        position: relative;
        margin-left: auto; // Push to the right
        
        // Hide on mobile - show all items instead
        @media (max-width: calc(#{nhs.$nhs-fdp-breakpoint-small-max})) {
          display: none;
        }
      }
    }

    // Navigation links styling (matching Header.scss)
    &-link {
      display: block;
      padding: 28px $header-link-padding;
      position: relative;
      white-space: nowrap;
      font-size: nhs.$nhs-fdp-font-size-16-mobile;
      font-weight: nhs.$nhs-fdp-font-weight-normal;

      @include header-link-style(
        $link-color: nhs.$nhs-fdp-color-primary-white,
        $link-hover-color: nhs.$nhs-fdp-color-primary-white,
        $link-active-color: nhs.$nhs-fdp-color-primary-white
      );

      @media (min-width: nhs.$nhs-fdp-breakpoint-medium) {
        font-size: nhs.$nhs-fdp-font-size-16-tablet;
      }

      // Visual indicator for navigation item uses a border on bottom edge (matching Header.scss)
      &::before {
        content: "";
        display: block;
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        border: 0 solid currentcolor;
      }

      // Visual indicator for current navigation
      &[aria-current="page"]::before,
      &[aria-current="true"]::before {
        border-bottom-width: $header-item-active-size;
      }
    }

    // CSS-only dropdown using <details> element
    &-details {
      position: relative;
      
      // Rotate chevron when open (from down to up)
      &[open] {
        .nhsuk-header__navigation-summary {
          .nhsuk-icon__chevron-down {
            transform: rotate(-90deg); // Point up when open
          }
        }
      }
    }
    
    // Summary styling (the "More" button) - matching header-link-style
    &-summary {
      display: flex;
      align-items: center;
      padding: nhs.$nhs-fdp-spacing-4 $header-link-padding;
      background: transparent;
      border: none;
      font-weight: nhs.$nhs-fdp-font-weight-normal;
      font-size: nhs.$nhs-fdp-font-size-16-mobile;
      line-height: 1.1;
      cursor: pointer;
      list-style: none; // Remove default details arrow
      white-space: nowrap;
      
      @include header-link-style(
        $link-color: nhs.$nhs-fdp-color-primary-white,
        $link-hover-color: nhs.$nhs-fdp-color-primary-white,
        $link-active-color: nhs.$nhs-fdp-color-primary-white
      );
      
      @media (min-width: nhs.$nhs-fdp-breakpoint-medium) {
        font-size: nhs.$nhs-fdp-font-size-16-tablet;
      }
      
      &::-webkit-details-marker {
        display: none; // Remove webkit default arrow
      }
      
      // Chevron icon
      .nhsuk-icon__chevron-down {
        width: nhs.$nhs-fdp-component-header-search-icon-size;
        height: nhs.$nhs-fdp-component-header-search-icon-size;
        margin-left: nhs.$nhs-fdp-spacing-1;
        transition: transform 0.2s ease;
        transform: rotate(90deg); // Start pointing down
      }
    }
    
    // Dropdown menu
    &-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      min-width: $header-static-dropdown-min-width;
      background: nhs.$nhs-fdp-color-primary-white;
      border: 1px solid nhs.$nhs-fdp-color-grey-3;
      border-radius: $header-static-border-radius;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      margin: 0;
      margin-top: nhs.$nhs-fdp-spacing-1;
      padding: 0;
      list-style: none;
      z-index: $header-static-dropdown-z-index;
      
      // Hide by default (details will handle showing)
      display: block;

      // Dropdown items (remove extra styling)
      &-item {
        margin: 0;
        
        // Current item styling (simpler approach)
        &--current {
          .nhsuk-header__navigation-dropdown-link {
            background-color: nhs.$nhs-fdp-color-grey-4;
            font-weight: nhs.$nhs-fdp-font-weight-bold;
          }
        }
      }
      
      // Dropdown links (matching mobile dropdown style from Header.scss)
      &-link {
        display: block;
        padding: nhs.$nhs-fdp-spacing-4 nhs.$nhs-fdp-spacing-4;
        color: nhs.$nhs-fdp-semantic-color-link-default;
        text-decoration: none;
        font-weight: nhs.$nhs-fdp-font-weight-normal;
        font-size: nhs.$nhs-fdp-font-size-16-mobile;
        line-height: 1.1;
        border-bottom: 1px solid nhs.$nhs-fdp-color-grey-4;
        
        @media (min-width: nhs.$nhs-fdp-breakpoint-medium) {
          font-size: nhs.$nhs-fdp-font-size-16-tablet;
        }
        
        &:hover {
          background-color: nhs.$nhs-fdp-color-grey-5;
          color: nhs.$nhs-fdp-semantic-color-link-default;
          text-decoration: underline;
        }
        
        &:focus {
          outline: nhs.$nhs-fdp-focus-outline-width nhs.$nhs-fdp-focus-outline-style nhs.$nhs-fdp-semantic-color-focus-background;
          outline-offset: -#{nhs.$nhs-fdp-focus-outline-width};
          background-color: nhs.$nhs-fdp-semantic-color-focus-background;
          color: nhs.$nhs-fdp-semantic-color-focus-text;
          box-shadow: inset 0 -#{nhs.$nhs-fdp-focus-outline-width} nhs.$nhs-fdp-semantic-color-focus-text;
        }
        
        &:active {
          background-color: nhs.$nhs-fdp-color-grey-3;
        }
        
        &:last-child {
          border-bottom: none;
        }
      }
    }
  }
}

// Mobile-first responsive behavior
@media (max-width: calc(#{nhs.$nhs-fdp-breakpoint-small-max})) {
  .nhsuk-header {
    &__navigation {
      &--static {
        // On mobile, show all navigation items without "More" dropdown
        .nhsuk-header__navigation-item--more {
          display: none; // Hide the "More" button
        }
        
        // Show all items in a vertical list
        .nhsuk-header__navigation-list--primary {
          flex-direction: column;
          
          .nhsuk-header__navigation-item--primary {
            width: 100%;
          }
        }
      }
    }
  }
}

// Desktop responsive behavior
@media (min-width: nhs.$nhs-fdp-breakpoint-medium) {
  .nhsuk-header {
    &__navigation {
      &--static {
        // On desktop, use horizontal layout with overflow handling
        .nhsuk-header__navigation-list--primary {
          flex-direction: row;
          flex-wrap: nowrap;
          overflow: hidden; // Prevent horizontal scroll
          
          // Ensure primary items don't wrap
          .nhsuk-header__navigation-item--primary {
            flex-shrink: 0;
            white-space: nowrap;
          }
          
          // Show "More" button when there are overflow items
          .nhsuk-header__navigation-item--more {
            display: flex;
          }
        }
      }
    }
  }
}

// Fallback for no-JavaScript scenario
.no-js {
  .nhsuk-header {
    &__navigation {
      &--static {
        // Without JavaScript, show all items in a simple list
        .nhsuk-header__navigation-item--more {
          display: none;
        }
        
        .nhsuk-header__navigation-list--primary {
          @media (min-width: nhs.$nhs-fdp-breakpoint-medium) {
            flex-wrap: wrap; // Allow wrapping if needed
            gap: nhs.$nhs-fdp-spacing-1;
          }
        }
      }
    }
  }
}

// Print styles
@media print {
  .nhsuk-header {
    &__navigation {
      &--static {
        .nhsuk-header__navigation-item--more {
          display: none;
        }
        
        .nhsuk-header__navigation-dropdown {
          display: none;
        }
        
        // Ensure all navigation items are visible in print
        .nhsuk-header__navigation-list--primary {
          flex-wrap: wrap;
          
          .nhsuk-header__navigation-item--primary {
            .nhsuk-header__navigation-link {
              color: nhs.$nhs-fdp-color-grey-1 !important;
              background-color: transparent !important;
            }
          }
        }
      }
    }
  }
}
