// AriaTabsDataGrid Component Styles
// ---------------------------------------------------------------------------
// Infra summary:
//  Mixins: atd-max($key), atd-between($min,$max), atd-snap-x(), atd-no-snap()
//  Placeholders: %atd-data-cell-focus, %atd-sort-priority-base
//  Breakpoints: phone(480) tablet(768) tabletMax(1024) wideTablet(1200)
//  Scroll snapping: enabled <= tabletMax; disabled on desktop >=1025px
//  Conventions: prefer mixins over raw @media; extend placeholders for reuse
// ---------------------------------------------------------------------------
@use '../../../packages/nhs-fdp/scss' as nhs;
@use 'sass:map';

// Component-specific variables using design tokens
$color-primary: nhs.$nhs-fdp-color-primary-blue;
$color-secondary: nhs.$nhs-fdp-color-grey-5;
$color-error: nhs.$nhs-fdp-color-primary-red;
$color-warning: nhs.$nhs-fdp-color-secondary-orange;
$color-success: nhs.$nhs-fdp-color-secondary-aqua-green;
$color-highlight: nhs.$nhs-fdp-color-primary-yellow;
$color-focus: nhs.$nhs-fdp-color-primary-yellow;
$color-text: nhs.$nhs-fdp-color-primary-black;
$color-text-secondary: nhs.$nhs-fdp-color-grey-1;
$color-disabled: nhs.$nhs-fdp-color-grey-2;
$color-white: nhs.$nhs-fdp-color-primary-white;

$border-radius: nhs.$nhs-fdp-border-radius-small;
$transition-default: all nhs.$nhs-fdp-animation-duration-normal nhs.$nhs-fdp-animation-easing-ease-out;
$font-family-primary: #{nhs.$nhs-fdp-font-family-base}, #{nhs.$nhs-fdp-font-family-fallback};

// ---------------------------------------------------------------------------
// Breakpoint & Utility Mixins (initial refactor pass)
// ---------------------------------------------------------------------------
// Centralised breakpoint tokens to reduce repeated literal ranges.
$atd-breakpoints: (
	phone: 480px,
	tablet: 768px,
	tabletMax: 1024px,
	wideTablet: 1200px
);

@mixin atd-max($key) {
	$size: map.get($atd-breakpoints, $key);
	@media (max-width: $size) { @content; }
}

@mixin atd-between($minKey, $maxKey) {
	$min: map.get($atd-breakpoints, $minKey);
	$max: map.get($atd-breakpoints, $maxKey);
	$minPlus: $min + 1px; // avoid overlap with max queries
	@media (min-width: #{$minPlus}) and (max-width: #{$max}) { @content; }
}

// Scroll snap helpers so we can switch behaviour without duplicating properties
@mixin atd-snap-x() { scroll-snap-type: x mandatory; scroll-behavior: smooth; }
@mixin atd-no-snap() { scroll-snap-type: none; }

// Shared placeholders (wrapped in & to avoid mixed-decls future change)
%atd-data-cell-focus { & { background-color: $color-primary; color: nhs.$nhs-fdp-semantic-color-text-primary; box-shadow: inset 0 0 0 nhs.$nhs-fdp-border-width-card-bottom nhs.$nhs-fdp-color-primary-black, 0 0 0 5px $color-highlight !important; border-radius: 0 !important; position: relative; z-index: 10; } }
%atd-sort-priority-base { & { font-weight: nhs.$nhs-fdp-font-weight-bold; border-radius: 50%; min-width: 20px; height: 20px; display: inline-flex; align-items: center; justify-content: center; font-size: nhs.$nhs-fdp-font-size-14-mobile; line-height: 1; transition: $transition-default; position: relative; flex-shrink: 0; &:focus-visible { outline: 2px solid $color-focus; outline-offset: 2px; } @include atd-max(tablet) { min-width: 18px; height: 18px; font-size: 10px; } } }

// Main component container
.aria-tabs-datagrid {
  font-family: $font-family-primary;
  background: $color-white;
  border-radius: 0;
  width: 100%; // Ensure full width utilisation
  max-width: 100%; // Prevent overflow
  overflow: hidden; // Contain child overflow
  // Loading and Error States
  &--loading,
  &--error {
	padding: nhs.$nhs-fdp-component-card-padding-desktop;
	text-align: center;
  }

  &--vertical {
	.aria-tabs-datagrid__tabs {
	  flex-direction: column;
	  border-right: nhs.$nhs-fdp-border-width-form-element solid $color-primary;
	  border-bottom: none;
	  width: 200px;
	  min-width: 200px;
	}

	.aria-tabs-datagrid__tab {
	  border-bottom: none;
	  border-right: nhs.$nhs-fdp-border-width-card-bottom solid transparent;
	  justify-content: flex-start;

	  &--selected {
		border-right-color: $color-primary;
	  }
	}
  }

  // Loading component
  &__loading {
	display: flex;
	flex-direction: column;
	align-items: center;
	gap: nhs.$nhs-fdp-spacing-4;
  }

  // Error component
  &__error {
	color: $color-error;
	border: nhs.$nhs-fdp-border-width-form-element solid $color-error;
	border-radius: $border-radius;
	padding: nhs.$nhs-fdp-spacing-4;
  }

  // Tab List
  &__tabs {
	display: flex;
	background: $color-secondary;
	gap: 0;
	margin: 0;
	padding: 0; // reset default list padding
	list-style: none;
	overflow-x: auto;
	scrollbar-width: thin; // Firefox
	-webkit-overflow-scrolling: touch; // iOS smooth scrolling
	scrollbar-gutter: stable both-edges; // Prevent layout shift when scrollbar appears
	// Explicitly pin left alignment to avoid transient centering between breakpoints
	justify-content: flex-start;
	overflow-y: hidden;
		// Ensure the first tab sits flush-left regardless of UA styles or scroll adjustments
		> .aria-tabs-datagrid__tab:first-child {
			margin-left: 0 !important;
		}
	
	// Custom scrollbar for webkit browsers
	&::-webkit-scrollbar {
	  height: 4px;
	}
	
	&::-webkit-scrollbar-track {
	  background: transparent;
	}
	
	&::-webkit-scrollbar-thumb {
	  background: nhs.$nhs-fdp-color-grey-3;
	  border-radius: 2px;
	  
	  &:hover {
		background: nhs.$nhs-fdp-color-grey-2;
	  }
	}

	@media (min-width: 769px) {
		position: revert;
	}
  }

  // Individual Tab
  &__tab {
	background: nhs.$nhs-fdp-color-grey-4; // Darker grey for non-selected tabs
	border: none;
	padding: nhs.$nhs-fdp-button-spacing-padding-vertical-desktop nhs.$nhs-fdp-spacing-3;
	cursor: pointer;
	font-family: inherit;
	font-size: nhs.$nhs-fdp-font-size-16-tablet;
	font-weight: nhs.$nhs-fdp-font-weight-bold;
	color: $color-text;
	white-space: nowrap;
	display: flex;
	align-items: center;
	gap: nhs.$nhs-fdp-spacing-2;
	transition: $transition-default;
	border-bottom: 2px solid $color-primary;
	flex-shrink: 0; // Prevent tabs from shrinking too much
	min-width: max-content; // Ensure tab content is fully visible
	position: relative;
	min-height: nhs.$nhs-fdp-form-spacing-input-min-height + nhs.$nhs-fdp-spacing-2;
	scroll-snap-align: start; // Snap alignment for mobile scrolling
	
	// Remove right border from the last tab to avoid double border with container
	// &:last-child {
	//   border-right: none;
	// }

	&:hover:not(&--disabled) {
	  background: nhs.$nhs-fdp-color-grey-3; // Lighter grey for better visual progression
	  color: nhs.$nhs-fdp-color-primary-blue;
	}

	&:focus {
	  outline: nhs.$nhs-fdp-border-width-card-bottom solid $color-focus;
	  outline-offset: -(nhs.$nhs-fdp-border-width-card-bottom);
	  background: $color-focus; // Bright yellow background for focus
	  color: $color-text; // Ensure text is readable on yellow
	  border-top-color: $color-focus; // Focus border
	  border-left-color: $color-focus;
	  border-right-color: $color-focus;
	  z-index: 10;
	  position: relative;
	  font-weight: 700; // Make focused tab bold for clarity
	}

	&--selected {
	  background: nhs.$nhs-fdp-color-grey-5;
	  color: nhs.$nhs-fdp-color-primary-blue;
	  border-top: 2px solid $color-primary;
	  border-left: 2px solid $color-primary;
	  border-right: 2px solid $color-primary;
	  border-bottom: 2px solid transparent; // Match the tab background to hide the border underneath
	  font-weight: 700;
	  margin-bottom: -1px; // Extend down to cover the gap between tab and panel
	  position: relative;
	  z-index: 1; // Ensure it appears above the container border
	}

	&--disabled {
	  opacity: 0.6;
	  cursor: not-allowed;
	  color: $color-disabled;
	}

	// Healthcare-specific tablet optimisations (consolidated via mixin)
    @include atd-between(tablet, wideTablet) {
    .aria-tabs-datagrid {
	&__tabs {
	  // Reinforce left alignment in this range (prevents brief centering jitter during resize)
	  justify-content: flex-start;
	}
	// Clinical workflow enhancements for bedside/mobile cart usage
	// Only apply healthcare-specific styling, avoid layout changes
	&__tab {
	  // Healthcare-specific tab styling with enhanced touch feedback
	  // Remove any border-radius or padding changes that interfere with base tab design
	  &--vitals {
		border-left: 4px solid $color-warning; // More prominent for tablet visibility
		
		&:hover,
		&:focus {
		  box-shadow: 0 0 0 2px $color-warning;
		}
	  }

	  &--discharge {
		border-left: 4px solid $color-success;
		
		&:hover,
		&:focus {
		  box-shadow: 0 0 0 2px $color-success;
		}
	  }

	  &--logistics {
		border-left: 4px solid nhs.$nhs-fdp-color-primary-dark-pink;
		
		&:hover,
		&:focus {
		  box-shadow: 0 0 0 2px nhs.$nhs-fdp-color-primary-dark-pink;
		}
	  }

	  &--overview {
		border-left: 4px solid $color-primary;
		
		&:hover,
		&:focus {
		  box-shadow: 0 0 0 2px $color-primary;
		}
	  }
	}
	
	// Enhanced data presentation for clinical context
	&__grid.nhsuk-table {
	  // Critical information highlighting for healthcare professionals
	  tbody tr {
		// Enhanced patient data row styling
		&[data-priority="high"] {
		  border-left: 4px solid $color-error;
		  background-color: rgba(nhs.$nhs-fdp-color-primary-red, 0.02);
		  
		  &:hover {
			background-color: rgba(nhs.$nhs-fdp-color-primary-red, 0.05);
		  }
		}
		
		&[data-priority="urgent"] {
		  border-left: 4px solid $color-warning;
		  background-color: rgba(nhs.$nhs-fdp-color-secondary-orange, 0.02);
		  
		  &:hover {
			background-color: rgba(nhs.$nhs-fdp-color-secondary-orange, 0.05);
		  }
		}
		
		// Touch-friendly row selection for patient records
		&.data-row--selected {
		  background-color: rgba(nhs.$nhs-fdp-color-primary-blue, 0.15);
		  border-left: 6px solid $color-primary; // Thicker border for tablet visibility
		  
		  &::before {
			content: "✓";
			position: absolute;
			left: nhs.$nhs-fdp-spacing-2;
			color: $color-primary;
			font-weight: bold;
			font-size: 18px;
		  }
		}
	  }
	  
	  // Enhanced cell content for tablet readability
	  td {
		// Minimum height for touch interaction
		min-height: 44px;
		
		// Critical data highlighting
		&[data-critical="true"] {
		  font-weight: nhs.$nhs-fdp-font-weight-bold;
		  color: $color-error;
		  position: relative;
		  
		  &::after {
			content: "!";
			position: absolute;
			right: nhs.$nhs-fdp-spacing-1;
			top: 50%;
			transform: translateY(-50%);
			color: $color-error;
			font-weight: bold;
			width: 16px;
			height: 16px;
			background: rgba(nhs.$nhs-fdp-color-primary-red, 0.1);
			border-radius: 50%;
			display: flex;
			align-items: center;
			justify-content: center;
			font-size: 12px;
		  }
		}
		
		// Medication data styling
		&[data-type="medication"] {
		  background-color: rgba(nhs.$nhs-fdp-color-secondary-aqua-green, 0.02);
		  border-left: 2px solid $color-success;
		}
		
		// Time-sensitive data styling
		&[data-time-sensitive="true"] {
		  background-color: rgba(nhs.$nhs-fdp-color-secondary-orange, 0.02);
		  border-left: 2px solid $color-warning;
		}
	  }
	}
	
	// Quick action buttons for healthcare workflows
	&__quick-actions {
	  display: flex;
	  gap: nhs.$nhs-fdp-spacing-2;
	  padding: nhs.$nhs-fdp-spacing-3;
	  background: nhs.$nhs-fdp-color-grey-5;
	  border-radius: nhs.$nhs-fdp-border-radius-medium;
	  margin-bottom: nhs.$nhs-fdp-spacing-3;
	  
	  .quick-action-btn {
		flex: 1;
		min-height: 48px; // Large touch target
		padding: nhs.$nhs-fdp-spacing-3;
		background: $color-white;
		border: 2px solid $color-primary;
		border-radius: nhs.$nhs-fdp-border-radius-small;
		color: $color-primary;
		font-weight: nhs.$nhs-fdp-font-weight-bold;
		font-size: nhs.$nhs-fdp-font-size-14-tablet;
		cursor: pointer;
		transition: all 0.2s ease;
		
		&:hover,
		&:active {
		  background: $color-primary;
		  color: $color-white;
		  transform: translateY(-1px);
		  box-shadow: nhs.$nhs-fdp-shadow-card-hover;
		}
		
		&:focus {
		  outline: 3px solid $color-focus;
		  outline-offset: 2px;
		}
		
		// Healthcare-specific action styling
		&--emergency {
		  border-color: $color-error;
		  color: $color-error;
		  
		  &:hover,
		  &:active {
			background: $color-error;
			color: $color-white;
		  }
		}
		
		&--medication {
		  border-color: $color-success;
		  color: $color-success;
		  
		  &:hover,
		  &:active {
			background: $color-success;
			color: $color-white;
		  }
		}
		
		&--notes {
		  border-color: $color-warning;
		  color: $color-warning;
		  
		  &:hover,
		  &:active {
			background: $color-warning;
			color: $color-white;
		  }
		}
	  }
	}
	
	// Enhanced table header optimization for tablet viewing
	&__grid.nhsuk-table {
	  th {
		// Improve header readability on smaller screens
		font-size: nhs.$nhs-fdp-font-size-14-tablet;
		padding: nhs.$nhs-fdp-spacing-2 nhs.$nhs-fdp-spacing-1;
		
		// Better touch targets for sortable headers
		&[role="columnheader"] {
		  min-height: 48px;
		  
		  button {
			min-height: 44px;
			padding: nhs.$nhs-fdp-spacing-2;
			
			// Ensure header text doesn't get truncated
			.header-content {
			  padding: nhs.$nhs-fdp-spacing-1 nhs.$nhs-fdp-spacing-2;
			  
			  .header-label {
				font-size: nhs.$nhs-fdp-font-size-14-tablet;
				line-height: 1.3;
				white-space: normal; // Allow wrapping on tablet
				word-break: break-word;
			  }
			}
		  }
		}
	  }
	}
  }
}

// Small tablet/large phone range (481px-768px) - specific fix for squishing issues
@media (min-width: 481px) and (max-width: 768px) {
  .aria-tabs-datagrid {
	// Enhanced table header optimization for cramped tablet viewing
	&__grid.nhsuk-table {
	  th {
		// Optimized for the problematic range
		font-size: nhs.$nhs-fdp-font-size-14-tablet;
		padding: nhs.$nhs-fdp-spacing-1 4px; // Tighter horizontal padding
		
		// Better touch targets for sortable headers
		&[role="columnheader"] {
		  min-height: 44px; // Slightly smaller than large tablets
		  
		  button {
			min-height: 40px;
			padding: nhs.$nhs-fdp-spacing-1 4px; // Compact padding
			
			// Optimized header content for this range
			.header-content {
			  padding: 4px 2px;
			  flex-wrap: wrap;
			  align-items: flex-start;
			  
			  .header-label {
				font-size: nhs.$nhs-fdp-font-size-14-tablet;
				line-height: 1.2; // Tight line height
				white-space: normal;
				word-break: break-word;
				overflow-wrap: break-word;
				hyphens: auto;
				max-width: 100%;
				
				// Handle very long header text
				&[data-long-text] {
				  font-size: 13px; // Slightly smaller for long headers
				}
			  }
			  
			  // Sort indicator positioning
			  .sort-indicator {
				margin-left: 2px; // Reduce spacing
				min-width: 16px; // Smaller indicator area
			  }
			}
		  }
		}
	  }
	  
	  // Optimize cell content for this range
	  td {
		padding: nhs.$nhs-fdp-spacing-1 4px;
		font-size: nhs.$nhs-fdp-font-size-14-tablet;
		line-height: 1.3;
	  }
	}
  }
}

// Tablet landscape specific optimizations - updated to align with systematic breakpoints
@media (min-width: 769px) and (max-width: 1024px) and (orientation: landscape) {
  .aria-tabs-datagrid {
	// Optimize for landscape tablet viewing (medical carts, bedside tablets)
	&__panel {
	  min-height: 500px; // Better use of landscape space
	}
	
	&__grid {
	  // Show more columns in landscape mode
	  .col-priority-medium {
		display: table-cell;
	  }
	  
	  // Adjust column distribution for landscape
	  .col-narrow { width: 8%; }
	  .col-medium { width: 15%; }
	  .col-wide { width: 22%; }
	  .col-flexible { width: auto; }
	}
	
	// Side-by-side layout for clinical efficiency
	&__content-layout {
	  display: grid;
	  grid-template-columns: 2fr 1fr;
	  gap: nhs.$nhs-fdp-spacing-4;
	  
	  .main-data {
		grid-column: 1;
	  }
	  
	  .patient-summary {
		grid-column: 2;
		background: nhs.$nhs-fdp-color-grey-5;
		padding: nhs.$nhs-fdp-spacing-4;
		border-radius: nhs.$nhs-fdp-border-radius-medium;
		
		h3 {
		  margin-top: 0;
		  color: $color-primary;
		  font-size: nhs.$nhs-fdp-font-size-19-tablet;
		}
		
		.summary-item {
		  display: flex;
		  justify-content: space-between;
		  padding: nhs.$nhs-fdp-spacing-2 0;
		  border-bottom: 1px solid nhs.$nhs-fdp-color-grey-4;
		  
		  &:last-child {
			border-bottom: none;
		  }
		  
		  .label {
			font-weight: nhs.$nhs-fdp-font-weight-bold;
			color: $color-text-secondary;
		  }
		  
		  .value {
			color: $color-text;
			
			&--critical {
			  color: $color-error;
			  font-weight: nhs.$nhs-fdp-font-weight-bold;
			}
			
			&--warning {
			  color: $color-warning;
			  font-weight: nhs.$nhs-fdp-font-weight-bold;
			}
		  }
		}
	  }
	}
  }
}
  }

  // Tab content elements
  &__tab-label {
	flex: 1;
  }

  &__tab-loading,
  &__tab-error {
	font-size: nhs.$nhs-fdp-font-size-14-tablet;
	margin-left: nhs.$nhs-fdp-spacing-1;
  }

  &__tab-error {
	color: $color-error;
  }

  // Tab Panels
  &__panel {
	background: $color-white;
	min-height: 400px; // Component-specific height, kept local
	border-radius: 0 0 $border-radius $border-radius; // Rounded bottom corners only
	outline: none; // Reset outline
	border-left: 2px solid $color-primary;
	border-right: 2px solid $color-primary;
	border-bottom: 2px solid $color-primary;
	margin-top: -2px; // Connect seamlessly with the tab
	overflow-x: auto; // Allow horizontal scrolling for wide content
	overflow-y: visible; // Allow vertical content to flow naturally
	
	// Enhanced scrollbar styling
	scrollbar-width: thin; // Firefox
	-webkit-overflow-scrolling: touch; // iOS smooth scrolling
	
	&::-webkit-scrollbar {
	  height: 8px;
	}
	
	&::-webkit-scrollbar-track {
	  background: nhs.$nhs-fdp-color-grey-5;
	  border-radius: nhs.$nhs-fdp-border-radius-small;
	}
	
	&::-webkit-scrollbar-thumb {
	  background: nhs.$nhs-fdp-color-grey-3;
	  border-radius: nhs.$nhs-fdp-border-radius-small;
	  
	  &:hover {
		background: nhs.$nhs-fdp-color-grey-2;
	  }
	}

	&:focus {
	  outline: nhs.$nhs-fdp-border-width-form-element solid $color-primary;
	  outline-offset: nhs.$nhs-fdp-spacing-1;
	}

	&[hidden] {
	  display: none;
	}
  }

  // Data Grid within Panels with increased specificity
  &__grid {
	border: none;
	box-shadow: none;
	width: 100%; // Ensure full width utilization
	max-width: 100%; // Prevent overflow

	&.nhsuk-table {
	  margin-bottom: 0;
	  border-collapse: collapse;
	  border-spacing: 0;
	  table-layout: auto; // Allow flexible column widths based on content
	  
	  // Consistent table cell padding using design tokens
	  th,
	  td {
		padding: nhs.$nhs-fdp-spacing-3 nhs.$nhs-fdp-spacing-2; // 12px vertical, 8px horizontal
		vertical-align: middle;
		min-width: 0; // Allow content to wrap and shrink
		word-break: break-word; // Handle long content gracefully
		// Border styling handled by specific row/header sections
		
		// Disable default browser focus-visible styling
		&:focus-visible {
		  outline: none;
		}
	  }
	  
	  // Header row specific styling
	  thead {
		th {
		  padding: nhs.$nhs-fdp-spacing-4 nhs.$nhs-fdp-spacing-1; // 16px vertical, 8px horizontal
		  background-color: nhs.$nhs-fdp-color-grey-5;
		  font-weight: nhs.$nhs-fdp-font-weight-bold;
		  font-size: nhs.$nhs-fdp-font-size-16-tablet;
		  color: $color-text;
		  position: relative;
		  border-top: nhs.$nhs-fdp-border-width-form-element solid nhs.$nhs-fdp-color-primary-blue;
		  border-bottom: nhs.$nhs-fdp-border-width-form-element solid nhs.$nhs-fdp-color-grey-4; // Darker grey for better separation
		  
		  // Sortable header styling
		  &.sortable-header {
			cursor: pointer;
			user-select: none;
			border-right: 1px solid nhs.$nhs-fdp-color-grey-4; // Column separator
			
			// Remove border from last column to avoid double border with table edge
			&:last-child {
			  border-right: none;
			}
			
			// Apply increased height when header has active sorting (desktop)
			&.sortable-header--sorted {
			  min-height: 56px; // Accommodate sort indicators
			}
			
			&:hover {
				background-color: nhs.$nhs-fdp-card-border-bottom;
			}

			// Handle long text and word wrapping in header content
			word-wrap: break-word;
			overflow-wrap: break-word;
			hyphens: auto;
			white-space: normal;

			// Ensure text doesn't overflow the container
			text-overflow: ellipsis;
			max-width: 100%;

			// Disable default browser focus-visible styling
			&:focus-visible {
			  outline: none;
			}
			
			&:hover {
			  background-color: nhs.$nhs-fdp-card-border-bottom;
			}
			
			// Header content layout - prevents text jumping
			.header-content {
			  display: flex;
			  align-items: center;
			  justify-content: flex-start; // Left-align the content
			  padding-left: nhs.$nhs-fdp-spacing-1;
			  min-height: 24px; // Consistent minimum height for header content
			  
			  // Apply vertical stacking for all constrained layouts (up to 1024px)
			  @media (max-width: 1400px) {
				flex-direction: column; // Stack vertically for better space utilization
				align-items: center;
				min-height: 32px;
				padding: nhs.$nhs-fdp-spacing-2;
				gap: nhs.$nhs-fdp-spacing-3;
			  }
			}
			
			.header-label {
			  flex: 1;
			  text-align: center; // Explicitly left-align the text
			  font-size: 14px; // Fixed size to prevent inheritance of 16px from parent th
			  word-break: break-word;
			  overflow-wrap: anywhere;
					line-height: 1.3;
					white-space: normal;
			  
			  // Consistent mobile-friendly typography for constrained layouts
			  @include atd-max(tabletMax) {
				font-size: 12px; // Keep consistent 14px across all breakpoints
				width: 100%; // Full width when stacked vertically
				margin-bottom: nhs.$nhs-fdp-spacing-1;
				line-height: 1.2;
				word-break: break-word;
				hyphens: auto;
			  }
			  
			  // Extra small screens get even smaller font
			  @include atd-max(phone) {
				font-size: nhs.$nhs-fdp-font-size-14-mobile;
			  }
			}
			
			// Sort indicator container - responsive space based on content
			.sort-indicator-container {
			  display: inline-flex;
			  align-items: center;
			  justify-content: center; // Center the priority indicator
			  margin-left: nhs.$nhs-fdp-spacing-2;
			  min-width: 20px; // Minimal space when no indicators
			  min-height: 20px; // Minimal height when no indicators
			  position: relative; // For absolute positioning of chevron
			  
			  // Expand to full size when containing sort indicators
			  &.sort-indicator--asc,
			  &.sort-indicator--desc {
				min-width: 44px; // Reserve space for priority indicator (20px) + arrow (20px) + gaps
				min-height: 44px; // Increased height for vertical stacking
			  }
			  
			  // Optimize for vertical layout on constrained screens
			  @include atd-max(tabletMax) {
				margin-left: 0; // Remove left margin when stacked vertically
				margin-top: nhs.$nhs-fdp-spacing-1;
				align-self: center; // Align to start when vertically stacked
				min-width: 40px; // Slightly smaller for constrained layouts
				min-height: 40px;
			  }
			}
			
			// Always visible sort priority styling (not just when focused)
			.sort-priority {
				@extend %atd-sort-priority-base;
				background: nhs.$nhs-fdp-color-grey-2;
				color: $color-white;
				border: 2px solid nhs.$nhs-fdp-color-grey-2;
				&:hover { transform: scale(1.1); box-shadow: nhs.$nhs-fdp-shadow-card-hover; }
				&--priority-1 { background: nhs.$nhs-fdp-color-primary-red; border-color: nhs.$nhs-fdp-color-primary-red; animation: pulse-priority 2s infinite; }
				&--priority-2 { background: nhs.$nhs-fdp-color-secondary-orange; border-color: nhs.$nhs-fdp-color-secondary-orange; }
				&--priority-3 { background: nhs.$nhs-fdp-color-primary-blue; border-color: nhs.$nhs-fdp-color-primary-blue; }
				&--priority-4 { background: nhs.$nhs-fdp-color-secondary-aqua-green; border-color: nhs.$nhs-fdp-color-secondary-aqua-green; }
				&--priority-5 { background: nhs.$nhs-fdp-color-grey-2; border-color: nhs.$nhs-fdp-color-grey-2; }
			}
			
			// Sort arrow styling
			.sort-arrow {
			  color: $color-text;
			  flex-shrink: 0; // Prevent shrinking in flex container
			  transition: $transition-default;
			  width: 30px; // Increased from 16px
			  height: 30px; // Increased from 16px
			  position: absolute; // Position relative to container
			  left: 50%; // Center horizontally
			  transform: translateX(-50%); // Center horizontally
			  
			  &.sort-arrow--asc {
				top: -20px; // Position further above the priority indicator
				transform: translateX(-50%) rotate(-90deg); // Center and rotate
			  }
			  
			  &.sort-arrow--desc {
				bottom: -20px; // Position further below the priority indicator
				transform: translateX(-50%) rotate(90deg); // Center and rotate
			  }
			  
			  &:hover {
				color: $color-primary;
			  }
			}
			
			// Enhanced Focus Styles for sortable headers
			&--focused {
			    background-color: $color-primary !important;
				color: $color-white !important;
				box-shadow: 
				inset 0 0 0 nhs.$nhs-fdp-border-width-card-bottom nhs.$nhs-fdp-color-primary-yellow,
				0 0 0 2px $color-highlight !important;
				position: relative;
				z-index: 5;

				.header-label {
					color: $color-white;
				}

				.sort-indicator {
					color: $color-white;
				}

				.sort-arrow {
					color: $color-white;
					fill: $color-white;

					// Keep centering translation to prevent horizontal jump
					&.sort-arrow--asc {
									// was: transform: rotate(-90deg);
									transform: translateX(-50%) rotate(-90deg);
					}

					&.sort-arrow--desc {
									// was: transform: rotate(90deg);
									transform: translateX(-50%) rotate(90deg);
					}
				}
			  
			  // Enhanced sort priority when focused - inherit the base styles but with white text
			  .sort-priority {
				// Color adjustments for focused state while maintaining base styling
				&--priority-1,
				&--priority-2,
				&--priority-4,
				&--priority-5 {
				  // Maintain the background colors but ensure visibility on focused header
				  box-shadow: nhs.$nhs-fdp-shadow-card-hover;
				  transform: scale(1.05);
				}
				&--priority-3 {
				  // Maintain the background colors but ensure visibility on focused header
				  //box-shadow: 0 2px 4px nhs.$nhs-fdp-color-primary-white;
				  background: nhs.$nhs-fdp-color-primary-white !important; // Ensure white background for visibility
				  color: nhs.$nhs-fdp-color-primary-blue !important;
				}
				
				&::before {
				  // Make sure the priority number is still visible on focused headers
				  background: $color-white;
				  color: $color-text;
				  border: 1px solid $color-primary;
				}
			  }
			}
		  }
		}
	  }
	  
	  // Data row styling with increased specificity
	  tbody {
		tr {
		  //transition: $transition-default;
		  border-bottom: 1px solid nhs.$nhs-fdp-color-grey-4;
		  
		  &:hover {
			background-color: rgba(nhs.$nhs-fdp-color-primary-blue, 0.02);
		  }
		  
		  td {
			font-size: nhs.$nhs-fdp-font-size-16-tablet;
			
			// Consistent cell content spacing
			&:first-child {
			  padding-left: nhs.$nhs-fdp-spacing-3; // 12px - restored to standard padding
			}
			
			&:last-child {
			  padding-right: nhs.$nhs-fdp-spacing-3; // 12px
			}
		  }
		}
	  }
	}

	// Visual indicator for active grid navigation (component-specific)
	&.grid-navigation-active {
	  background-color: rgba(nhs.$nhs-fdp-color-primary-blue, 0.05);
	  border: nhs.$nhs-fdp-border-width-form-element solid $color-primary;
	}
	
	// Adaptive column width utilities for responsive tables
	.col-narrow { 
	  width: 8%; 
	  min-width: 60px; // Ensure minimum usable width
	}
	
	.col-medium { 
	  width: 15%; 
	  min-width: 100px;
	}
	
	.col-wide { 
	  width: 25%; 
	  min-width: 150px;
	}
	
	.col-flexible { 
	  width: auto; 
	  min-width: 120px;
	}
	
	// Priority-based column visibility for responsive design
	.col-priority-high {
	  // Always visible - no special rules needed
	  display: table-cell;
	}
	
	.col-priority-medium {
	  @include atd-max(tablet) {
		display: none;
	  }
	}
	
	.col-priority-low {
	  @include atd-max(tabletMax) {
		display: none;
	  }
	}
  }

  // Keyboard navigation help text
  &__navigation-help {
	font-size: nhs.$nhs-fdp-font-size-14-tablet;
	color: $color-text-secondary;
	margin-top: nhs.$nhs-fdp-spacing-2;
	padding: nhs.$nhs-fdp-spacing-2;
	background-color: $color-secondary;
	border-radius: $border-radius;

	&.sr-only {
	  position: absolute;
	  width: 1px;
	  height: 1px;
	  padding: 0;
	  margin: -1px;
	  overflow: hidden;
	  clip: rect(0, 0, 0, 0);
	  white-space: nowrap;
	  border: 0;
	}
  }

  // Sort status and reset controls
  &__sort-status {
	display: flex;
	align-items: center;
	justify-content: space-between;
	gap: nhs.$nhs-fdp-spacing-3;
	padding: nhs.$nhs-fdp-spacing-3;
	background: nhs.$nhs-fdp-color-grey-5;
	border: nhs.$nhs-fdp-border-width-default solid nhs.$nhs-fdp-color-grey-4;
	border-radius: $border-radius;
	margin-bottom: nhs.$nhs-fdp-spacing-3;
	font-size: nhs.$nhs-fdp-font-size-14-tablet;
	color: $color-text-secondary;

	@include atd-max(tablet) {
	  flex-direction: column;
	  align-items: flex-start;
	  gap: nhs.$nhs-fdp-spacing-2;
	}
  }

  &__sort-description {
	flex: 1;
	font-weight: normal;
	
	// Active state class applied when sorts are present
	&--active {
	  color: $color-text;
	  font-weight: nhs.$nhs-fdp-font-weight-bold;
	}
  }

  &__reset-sorts {
	background: $color-white;
	border: nhs.$nhs-fdp-border-width-default solid $color-primary;
	color: $color-primary;
	padding: nhs.$nhs-fdp-spacing-2 nhs.$nhs-fdp-spacing-3;
	border-radius: $border-radius;
	font-size: nhs.$nhs-fdp-font-size-14-tablet;
	font-weight: nhs.$nhs-fdp-font-weight-bold;
	cursor: pointer;
	transition: $transition-default;
	white-space: nowrap;

	&:hover {
	  background: $color-primary;
	  color: $color-white;
	  box-shadow: nhs.$nhs-fdp-shadow-button-default;
	}

	&:focus-visible {
	  outline: nhs.$nhs-fdp-border-width-form-element solid $color-focus;
	  outline-offset: 2px;
	}

	&:active {
	  transform: translateY(1px);
	  box-shadow: none;
	}
  }
}

// Data cell focus styles (component-specific)
.data-cell {
	&--focused { @extend %atd-data-cell-focus; }

	// Wrapper applied when a column supplies customRenderer
	&__custom {
		display: inline-flex;
		align-items: center;
		justify-content: center;
		width: 100%;
		text-align: center;
		gap: nhs.$nhs-fdp-spacing-1;

		// Ensure icons / text don't stick to cell edges
		//padding-inline: nhs.$nhs-fdp-spacing-1;

		// Allow wrapping if very long custom content
		white-space: normal;

		// Accessible focus if nested interactive elements are introduced
		&:focus-within {
			outline: 2px solid $color-focus;
			outline-offset: 2px;
		}
	}
}

// Enhanced sort priority in table headers
.sortable-table-header {
  .sort-priority-container {
	display: inline-flex;
	align-items: center;
	gap: nhs.$nhs-fdp-spacing-1;
	margin-left: nhs.$nhs-fdp-spacing-2;
	
	// Mobile-specific adjustments
	@include atd-max(tablet) {
	  gap: calc(nhs.$nhs-fdp-spacing-1 / 2);
	  margin-left: nhs.$nhs-fdp-spacing-1;
	}
	
	.sort-priority {
	  @extend %atd-sort-priority-base;
	  background: nhs.$nhs-fdp-color-grey-2;
	  color: $color-white;
	  border: 2px solid nhs.$nhs-fdp-color-grey-2;
	  &:hover { transform: scale(1.1); box-shadow: nhs.$nhs-fdp-shadow-card-hover; }
	  &--small { min-width:16px; height:16px; font-size:10px; }
	  &--large { min-width:24px; height:24px; font-size: nhs.$nhs-fdp-font-size-14-tablet; }
	  &--connected { position:relative; &::after { content:''; position:absolute; left:100%; top:50%; width: nhs.$nhs-fdp-spacing-2; height:2px; background: nhs.$nhs-fdp-color-grey-3; transform: translateY(-50%); } &:last-child::after { display:none; } }
	  &--priority-1 { background: nhs.$nhs-fdp-color-primary-red; border-color: nhs.$nhs-fdp-color-primary-red; }
	  &--priority-2 { background: nhs.$nhs-fdp-color-secondary-orange; border-color: nhs.$nhs-fdp-color-secondary-orange; }
	  &--priority-3 { background: nhs.$nhs-fdp-color-primary-blue; border-color: nhs.$nhs-fdp-color-primary-blue; }
	  &--priority-4 { background: nhs.$nhs-fdp-color-secondary-aqua-green; border-color: nhs.$nhs-fdp-color-secondary-aqua-green; }
	  &--priority-5 { background: nhs.$nhs-fdp-color-grey-2; border-color: nhs.$nhs-fdp-color-grey-2; }
	}
  }
}

// Row Selection and Focus Styles (component-specific)
.data-row {
  // Selected row styles
  &--selected {
	background-color: rgba(nhs.$nhs-fdp-color-primary-blue, 0.15); // Lighter blue tint

	&:hover {
	  background-color: rgba(nhs.$nhs-fdp-color-primary-blue, 0.25); // Darker on hover
	}

	td {
	  background-color: inherit;
	  border-color: $color-primary;
	}
  }

  // Focused row styles for keyboard navigation
  &--focused {
	background-color: $color-secondary;
	outline: nhs.$nhs-fdp-spacing-1 solid $color-highlight; // 5px total
	outline-offset: 0px;

	td {
	  background-color: inherit;
	}

	// Combined selected and focused state
	&.data-row--selected {
	  background-color: rgba(nhs.$nhs-fdp-color-primary-blue, 0.4);
	  outline: nhs.$nhs-fdp-spacing-1 + 1px solid $color-highlight; // 5px
	}
  }
}

// Loading spinner (component-specific animation)
.nhsuk-spinner {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: nhs.$nhs-fdp-spacing-1 - 1px solid nhs.$nhs-fdp-color-grey-4; // 3px
  border-top: nhs.$nhs-fdp-spacing-1 - 1px solid $color-primary; // 3px
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

// Priority pulse animation for high-priority sorts
@keyframes pulse-priority {
  0%, 100% {
	transform: scale(1);
	box-shadow: 0 0 0 0 rgba(213, 40, 27, 0.4);
  }
  50% {
	transform: scale(1.05);
	box-shadow: 0 0 0 6px rgba(213, 40, 27, 0.1);
  }
}

// Screen reader only content
.nhsuk-u-visually-hidden {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

// Responsive Design - Phase 2: Enhanced Tablet Experience - updated for systematic breakpoints
@media (min-width: 769px) and (max-width: 1024px) {
  .aria-tabs-datagrid {
	
	&__tab {
	  // Enhanced touch targets - minimum 44px as per accessibility guidelines
	  min-height: 44px;
	  padding: nhs.$nhs-fdp-spacing-3 nhs.$nhs-fdp-spacing-4; // Increased padding for touch
	  font-size: nhs.$nhs-fdp-font-size-16-tablet;
	  // REMOVED: border-radius that was causing tab appearance issues
	  
	  // Touch-friendly active/hover states
	  &:hover,
	  &:active {
		transform: translateY(-1px); // Subtle lift effect for touch feedback
		box-shadow: nhs.$nhs-fdp-shadow-button-default;
		transition: transform 0.1s ease-out, box-shadow 0.1s ease-out;
	  }
	  
	  // Enhanced focus states for tablet navigation
	  &:focus {
		outline: 3px solid $color-focus;
		//outline-offset: 2px;
		z-index: 20; // Higher than mobile to ensure visibility
	  }

	  @media (max-width: 769px) {
		z-index: 20;
	  }
	}
	
	&__panel {
	  // Optimized panel spacing for tablet viewing
	  border-radius: 0 0 nhs.$nhs-fdp-border-radius-medium nhs.$nhs-fdp-border-radius-medium;
	  
	  // Enhanced scrolling for tablet touch gestures
	  scroll-behavior: smooth;
	  -webkit-overflow-scrolling: touch;
	  
	  // Improved scrollbar for tablet interaction
	  &::-webkit-scrollbar {
		height: 12px; // Larger for easier touch interaction
	  }
	  
	  &::-webkit-scrollbar-track {
		background: nhs.$nhs-fdp-color-grey-5;
		border-radius: 6px;
	  }
	  
	  &::-webkit-scrollbar-thumb {
		background: nhs.$nhs-fdp-color-grey-2;
		border-radius: 6px;
		border: 2px solid nhs.$nhs-fdp-color-grey-5; // Create visual separation
		
		&:hover {
		  background: nhs.$nhs-fdp-color-grey-1;
		}
	  }
	}
	
	&__grid {
	  // Tablet-optimized table layout
	  &.nhsuk-table {
		th, td {
		  padding: nhs.$nhs-fdp-spacing-3 nhs.$nhs-fdp-spacing-3; // Increased padding for touch
		  font-size: nhs.$nhs-fdp-font-size-16-tablet; // Optimal reading size for tablets
		}
		
		thead th {
		  // Enhanced sortable headers for tablet interaction
		  &.sortable-header {
			min-height: 40px; // Base height for tablet touch targets
			border-right: 1px solid nhs.$nhs-fdp-color-grey-3; // Column separator
			
			// Remove border from last column to avoid double border with table edge
			&:last-child {
			  border-right: none;
			}
			
			&:hover,
			&:active {
			  background-color: nhs.$nhs-fdp-color-grey-4;
			  transform: none; // Remove transform for table headers
			}
			
			// Enhanced sort indicator spacing for tablet - responsive
			.sort-indicator-container {
			  min-width: 24px; // Minimal space when no indicators
			  min-height: 24px;
			  
			  // Expand to full size when containing sort indicators
			  &.sort-indicator--asc,
			  &.sort-indicator--desc {
				min-width: 48px; // Larger touch target for sorted columns
				min-height: 48px;
			  }
			}
			
			// Apply increased height when header has active sorting
			&.sortable-header--sorted {
			  min-height: 56px !important; // Override base 40px when sort indicators are present
			}
			
			.sort-priority {
			  min-width: 24px; // Larger for tablet interaction
			  height: 24px;
			  font-size: nhs.$nhs-fdp-font-size-14-tablet;
			  
			  // Enhanced hover states for tablet
			  &:hover {
				transform: scale(1.15); // More pronounced for tablet
				box-shadow: nhs.$nhs-fdp-shadow-card-hover;
			  }
			}
			
			.sort-arrow {
			  width: 24px; // Larger arrows for tablet visibility
			  height: 24px;
			}
		  }
		}
		
		tbody tr {
		  // Enhanced row interaction for tablet
		  &:hover {
			background-color: rgba(nhs.$nhs-fdp-color-primary-blue, 0.05);
			cursor: pointer; // Indicate interactivity
		  }
		  
		  // Touch-friendly row selection feedback
		  &.data-row--selected {
			background-color: rgba(nhs.$nhs-fdp-color-primary-blue, 0.12);
			border-left: 4px solid $color-primary; // Visual selection indicator
		  }
		}
	  }
	  
	  // Optimized column widths for tablet landscape
	  .col-narrow { 
		width: 10%; 
		min-width: 80px;
	  }
	  
	  .col-medium { 
		width: 18%; 
		min-width: 120px;
	  }
	  
	  .col-wide { 
		width: 28%; 
		min-width: 180px;
	  }
	  
	  .col-flexible { 
		width: auto; 
		min-width: 140px; // Slightly larger for tablet
	  }
	}
	
	// Enhanced sort status for tablet
	&__sort-status {
	  padding: nhs.$nhs-fdp-spacing-4;
	  font-size: nhs.$nhs-fdp-font-size-16-tablet;
	  border-radius: nhs.$nhs-fdp-border-radius-medium;
	}
	
	&__reset-sorts {
	  padding: nhs.$nhs-fdp-spacing-3 nhs.$nhs-fdp-spacing-4; // Larger touch target
	  font-size: nhs.$nhs-fdp-font-size-16-tablet;
	  min-height: 44px; // Accessibility guideline compliance
	  
	  &:hover {
		transform: translateY(-1px);
		box-shadow: nhs.$nhs-fdp-shadow-card-hover;
	  }
	  
	  &:active {
		transform: translateY(0);
	  }
	}
  }
  
  // Enhanced focus styles for tablet navigation
  .sortable-header {
	&--focused {
	  // More prominent focus for tablet users
	  box-shadow: 
		inset 0 0 0 3px nhs.$nhs-fdp-color-primary-black,
		0 0 0 3px $color-highlight !important;
	  transform: scale(1.02); // Subtle scale for tablet feedback
	}
  }
  
	.data-cell { &--focused { // Tablet refinement: lighter outer outline & subtle scale
		box-shadow:
			inset 0 0 0 3px nhs.$nhs-fdp-color-primary-black,
			0 0 0 4px $color-highlight !important;
		transform: scale(1.02);
	} }
}

// Unified phone breakpoint adjustments (merged duplicate @media blocks)
@include atd-max(phone) {
	.aria-tabs-datagrid {
		&__tab {
			padding: nhs.$nhs-fdp-button-spacing-padding-vertical-mobile nhs.$nhs-fdp-button-spacing-padding-horizontal-mobile;
			font-size: nhs.$nhs-fdp-font-size-14-mobile;
			min-width: 120px;
		}
		&__grid.nhsuk-table {
			th {
				font-size: nhs.$nhs-fdp-font-size-14-mobile;
				padding: nhs.$nhs-fdp-spacing-1;
				&[role="columnheader"] { min-height: 44px; button { min-height: 40px; padding: nhs.$nhs-fdp-spacing-1; } }
			}
			td { min-width: 0; word-break: break-word; hyphens: auto; }
		}
		&--vertical { flex-direction: column; .aria-tabs-datagrid__tabs { width:100%; flex-direction:row; border-right:none; } }

		// Extra-small tightening (previous second block)
		&__grid.nhsuk-table {
			th[role="columnheader"] button .header-content {
				padding: 4px 2px;
				.header-label {
					font-size: 12px; line-height:1.1;
					&[data-full-text]::after { content:"..."; opacity:0.7; }
				}
			}
		}
	}
}

// High Contrast Mode Support
@media (forced-colors: active) {
  .aria-tabs-datagrid__tab {
	border: nhs.$nhs-fdp-border-width-default solid ButtonText;
	
	&--selected {
	  background: Highlight;
	  color: HighlightText;
	}
  }
  
  // High contrast support for sort priorities
  .sort-priority {
	background: ButtonText !important;
	color: ButtonFace !important;
	border: 2px solid ButtonText !important;
	
	&::before {
	  background: ButtonFace !important;
	  color: ButtonText !important;
	  border: 1px solid ButtonText !important;
	}
	
	&--priority-1 {
	  // Use system highlight for highest priority in high contrast
	  background: Highlight !important;
	  color: HighlightText !important;
	}
  }
  
  .sortable-table-header .sort-priority {
	&--connected::after {
	  background: ButtonText !important;
	}
  }
}

// Print Styles
@media print {
  .aria-tabs-datagrid {
	&__tabs {
	  display: none;
	}
	
	&__panel {
	  &[hidden] {
		display: block;
	  }
	  
	  page-break-inside: avoid;
	}
  }
}

// Desktop explicit overrides (beyond tablet breakpoints) – disable snap
@media (min-width: 1025px) {
	.aria-tabs-datagrid {
		&__tabs {
			@include atd-no-snap();
			justify-content: flex-start !important; // Ensure no centering from user-agent or transient flex distribution
			align-items: stretch;
		}
	}
}

// Enable scroll snapping only for <= tabletMax
@include atd-max(tabletMax) { .aria-tabs-datagrid__tabs { @include atd-snap-x(); } }
