// AriaTabsDataGrid Component Styles
@use '../../../packages/nhs-fdp/scss' as nhs;

// Component-specific variables using design tokens
$color-primary: nhs.$nhs-fdp-color-primary-blue;
$color-secondary: nhs.$nhs-fdp-color-grey-5;
$color-error: nhs.$nhs-fdp-color-primary-red;
$color-warning: nhs.$nhs-fdp-color-secondary-orange;
$color-success: nhs.$nhs-fdp-color-secondary-aqua-green;
$color-highlight: nhs.$nhs-fdp-color-primary-yellow;
$color-focus: nhs.$nhs-fdp-color-primary-yellow;
$color-text: nhs.$nhs-fdp-color-primary-black;
$color-text-secondary: nhs.$nhs-fdp-color-grey-1;
$color-disabled: nhs.$nhs-fdp-color-grey-2;
$color-white: nhs.$nhs-fdp-color-primary-white;

$border-radius: nhs.$nhs-fdp-border-radius-small;
$transition-default: all nhs.$nhs-fdp-animation-duration-normal nhs.$nhs-fdp-animation-easing-ease-out;
$font-family-primary: #{nhs.$nhs-fdp-font-family-base}, #{nhs.$nhs-fdp-font-family-fallback};

// Main component container
.aria-tabs-datagrid {
  font-family: $font-family-primary;
  background: $color-white;
  border-radius: $border-radius;
  box-shadow: nhs.$nhs-fdp-shadow-card-hover;

  // Loading and Error States
  &--loading,
  &--error {
    padding: nhs.$nhs-fdp-component-card-padding-desktop;
    text-align: center;
  }

  &--vertical {
    .aria-tabs-datagrid__tabs {
      flex-direction: column;
      border-right: nhs.$nhs-fdp-border-width-form-element solid $color-primary;
      border-bottom: none;
      width: 200px;
      min-width: 200px;
    }

    .aria-tabs-datagrid__tab {
      border-bottom: none;
      border-right: nhs.$nhs-fdp-border-width-card-bottom solid transparent;
      justify-content: flex-start;

      &--selected {
        border-right-color: $color-primary;
      }
    }
  }

  // Loading component
  &__loading {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: nhs.$nhs-fdp-spacing-4;
  }

  // Error component
  &__error {
    color: $color-error;
    border: nhs.$nhs-fdp-border-width-form-element solid $color-error;
    border-radius: $border-radius;
    padding: nhs.$nhs-fdp-spacing-4;
  }

  // Tab List
  &__tabs {
    display: flex;
    background: $color-secondary;
    gap: 0;
    margin: 0;
    padding: 0;
    list-style: none;
    overflow-x: auto;

  }

  // Individual Tab
  &__tab {
    background: nhs.$nhs-fdp-color-grey-4; // Darker grey for non-selected tabs
    border: none;
    padding: nhs.$nhs-fdp-button-spacing-padding-vertical-desktop nhs.$nhs-fdp-spacing-3;
    cursor: pointer;
    font-family: inherit;
    font-size: nhs.$nhs-fdp-font-size-16-tablet;
    font-weight: nhs.$nhs-fdp-font-weight-bold;
    color: $color-text;
    white-space: nowrap;
    display: flex;
    align-items: center;
    gap: nhs.$nhs-fdp-spacing-2;
    transition: $transition-default;
    border-bottom: 2px solid $color-primary;
    position: relative;
    min-height: nhs.$nhs-fdp-form-spacing-input-min-height + nhs.$nhs-fdp-spacing-2;

    // Remove right border from the last tab to avoid double border with container
    // &:last-child {
    //   border-right: none;
    // }

    &:hover:not(&--disabled) {
      background: nhs.$nhs-fdp-color-grey-3; // Lighter grey for better visual progression
      color: $color-primary;
    }

    &:focus {
      outline: nhs.$nhs-fdp-border-width-card-bottom solid $color-focus;
      outline-offset: -(nhs.$nhs-fdp-border-width-card-bottom);
      background: nhs.$nhs-fdp-color-grey-3; // Match the hover state
      border-top-color: $color-focus; // Focus border
      border-left-color: $color-focus;
      border-right-color: $color-focus;
      z-index: 10;
      position: relative;
    }

    &--selected {
      background: nhs.$nhs-fdp-color-grey-5;
      color: $color-primary;
      border-top: 2px solid $color-primary;
      border-left: 2px solid $color-primary;
      border-right: 2px solid $color-primary;
      border-bottom: 2px solid nhs.$nhs-fdp-color-grey-5; // Match the tab background to hide the border underneath
      font-weight: 700;
      margin-bottom: -1px; // Extend down to cover the gap between tab and panel
      position: relative;
      z-index: 1; // Ensure it appears above the container border
    }

    &--disabled {
      opacity: 0.6;
      cursor: not-allowed;
      color: $color-disabled;
    }

    // Healthcare-specific tab styling (component-specific, kept as local styles)
    &--vitals {
      border-left: nhs.$nhs-fdp-border-width-card-bottom solid $color-warning;
    }

    &--discharge {
      border-left: nhs.$nhs-fdp-border-width-card-bottom solid $color-success;
    }

    &--logistics {
      border-left: nhs.$nhs-fdp-border-width-card-bottom solid nhs.$nhs-fdp-color-primary-dark-pink;
    }

    &--overview {
      border-left: nhs.$nhs-fdp-border-width-card-bottom solid $color-primary;
    }
  }

  // Tab content elements
  &__tab-label {
    flex: 1;
  }

  &__tab-loading,
  &__tab-error {
    font-size: nhs.$nhs-fdp-font-size-14-tablet;
    margin-left: nhs.$nhs-fdp-spacing-1;
  }

  &__tab-error {
    color: $color-error;
  }

  // Tab Panels
  // Update the panel styling around line 167
	&__panel {
		background: $color-white;
		min-height: 400px; // Component-specific height, kept local
		border-radius: 0 0 $border-radius $border-radius; // Rounded bottom corners only
		outline: none; // Reset outline
		border-left: 2px solid $color-primary;
		border-right: 2px solid transparent;
		border-bottom: 2px solid $color-primary;
		margin-top: -2px; // Connect seamlessly with the tab

		&:focus {
				outline: nhs.$nhs-fdp-border-width-form-element solid $color-primary;
				outline-offset: nhs.$nhs-fdp-spacing-1;
		}

		&[hidden] {
				display: none;
		}
	}

  // Data Grid within Panels with increased specificity
  &__grid {
    border: none;
    box-shadow: none;

    &.nhsuk-table {
      margin-bottom: 0;
	  border-collapse: collapse;
      border-spacing: 0;
	  border-right: 2px solid $color-primary;
      // Consistent table cell padding using design tokens
      th,
      td {
        padding: nhs.$nhs-fdp-spacing-3 nhs.$nhs-fdp-spacing-2; // 12px vertical, 8px horizontal
		vertical-align: middle;
		// Border styling handled by specific row/header sections
		
		// Disable default browser focus-visible styling
		&:focus-visible {
			outline: none;
		}
      }
      
      // Header row specific styling
      thead {
        th {
          padding: nhs.$nhs-fdp-spacing-4 nhs.$nhs-fdp-spacing-2; // 16px vertical, 8px horizontal
          background-color: nhs.$nhs-fdp-color-grey-5;
          font-weight: nhs.$nhs-fdp-font-weight-bold;
          font-size: nhs.$nhs-fdp-font-size-16-tablet;
          color: $color-text;
          position: relative;
		  border-top: nhs.$nhs-fdp-border-width-form-element solid nhs.$nhs-fdp-color-primary-blue;
          border-bottom: nhs.$nhs-fdp-border-width-form-element solid nhs.$nhs-fdp-color-grey-4; // Darker grey for better separation
          
          // Sortable header styling
          &.sortable-header {
            cursor: pointer;
            user-select: none;
			//border-right: 1px solid nhs.$nhs-fdp-color-grey-3;
            
            // Disable default browser focus-visible styling
            &:focus-visible {
              outline: none;
            }
            
            &:hover {
              background-color: nhs.$nhs-fdp-semantic-surface-interactive-hover;
            }
            
            // Header content layout - prevents text jumping
            .header-content {
              display: flex;
              align-items: center;
              justify-content: flex-start; // Left-align the content
			  padding-left: nhs.$nhs-fdp-spacing-1;
              min-height: 24px; // Consistent minimum height for header content
            }
            
            .header-label {
              flex: 1;
              text-align: left; // Explicitly left-align the text
            }
            
            // Sort indicator container - fixed space to prevent jumping
            .sort-indicator-container {
              display: inline-flex;
              align-items: center;
              justify-content: center; // Center the priority indicator
              margin-left: nhs.$nhs-fdp-spacing-2;
              min-width: 44px; // Reserve space for priority indicator (20px) + arrow (20px) + gaps
              min-height: 44px; // Increased height for vertical stacking
              position: relative; // For absolute positioning of chevron
            }
            
            // Always visible sort priority styling (not just when focused)
            .sort-priority {
				background: nhs.$nhs-fdp-color-grey-2;
              font-weight: nhs.$nhs-fdp-font-weight-bold;
              color: $color-white;
              border-radius: 50%;
              min-width: 20px;
              height: 20px;
              display: inline-flex;
              align-items: center;
              justify-content: center;
              font-size: nhs.$nhs-fdp-font-size-14-mobile; // 12px
              line-height: 1;
              transition: $transition-default;
              position: relative;
              flex-shrink: 0; // Prevent shrinking in flex container
              
              // Priority level styling with NHS colors
              &--priority-1 {
                background: nhs.$nhs-fdp-color-primary-red;
                border: 2px solid nhs.$nhs-fdp-color-primary-red;
                animation: pulse-priority 2s infinite;
              }
              
              &--priority-2 {
                background: nhs.$nhs-fdp-color-secondary-orange;
                border: 2px solid nhs.$nhs-fdp-color-secondary-orange;
              }
              
              &--priority-3 {
                background: nhs.$nhs-fdp-color-primary-blue;
                border: 2px solid nhs.$nhs-fdp-color-primary-blue;
              }
              
              &--priority-4 {
                background: nhs.$nhs-fdp-color-secondary-aqua-green;
                border: 2px solid nhs.$nhs-fdp-color-secondary-aqua-green;
              }
              
              &--priority-5 {
                background: nhs.$nhs-fdp-color-grey-2;
                border: 2px solid nhs.$nhs-fdp-color-grey-2;
              }
              
              // Hover effects
              &:hover {
                transform: scale(1.1);
                box-shadow: nhs.$nhs-fdp-shadow-card-hover;
              }
              
              // Focus styles for accessibility
              &:focus-visible {
                outline: 2px solid $color-focus;
                outline-offset: 2px;
              }
              
              // Mobile-specific adjustments
              @media (max-width: 768px) {
                min-width: 18px;
                height: 18px;
                font-size: 10px;
                
                &::before {
                  width: 14px;
                  height: 14px;
                  font-size: 9px;
                  top: -7px;
                  right: -7px;
                }
              }
            }
            
            // Sort arrow styling
            .sort-arrow {
              color: $color-text;
              flex-shrink: 0; // Prevent shrinking in flex container
              transition: $transition-default;
              width: 30px; // Increased from 16px
              height: 30px; // Increased from 16px
              position: absolute; // Position relative to container
              left: 50%; // Center horizontally
              transform: translateX(-50%); // Center horizontally
              
              &.sort-arrow--asc {
                top: -20px; // Position further above the priority indicator
                transform: translateX(-50%) rotate(-90deg); // Center and rotate
              }
              
              &.sort-arrow--desc {
                bottom: -20px; // Position further below the priority indicator
                transform: translateX(-50%) rotate(90deg); // Center and rotate
              }
              
              &:hover {
                color: $color-primary;
              }
            }
          }
        }
      }
      
      // Data row styling with increased specificity
      tbody {
        tr {
          //transition: $transition-default;
          border-bottom: 1px solid nhs.$nhs-fdp-color-grey-4;
          
          &:hover {
            background-color: rgba(nhs.$nhs-fdp-color-primary-blue, 0.02);
          }
          
          td {
            font-size: nhs.$nhs-fdp-font-size-16-tablet;
            
            // Consistent cell content spacing
            &:first-child {
              padding-left: nhs.$nhs-fdp-spacing-3; // 12px - restored to standard padding
            }
            
            &:last-child {
              padding-right: nhs.$nhs-fdp-spacing-3; // 12px
            }
          }
        }
      }
    }

    // Visual indicator for active grid navigation (component-specific)
    &.grid-navigation-active {
      background-color: rgba(nhs.$nhs-fdp-color-primary-blue, 0.05);
      border: nhs.$nhs-fdp-border-width-form-element solid $color-primary;
    }
  }

  // Keyboard navigation help text
  &__navigation-help {
    font-size: nhs.$nhs-fdp-font-size-14-tablet;
    color: $color-text-secondary;
    margin-top: nhs.$nhs-fdp-spacing-2;
    padding: nhs.$nhs-fdp-spacing-2;
    background-color: $color-secondary;
    border-radius: $border-radius;

    &.sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }
  }

  // Sort status and reset controls
  &__sort-status {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: nhs.$nhs-fdp-spacing-3;
    padding: nhs.$nhs-fdp-spacing-3;
    background: nhs.$nhs-fdp-color-grey-5;
    border: nhs.$nhs-fdp-border-width-default solid nhs.$nhs-fdp-color-grey-4;
    border-radius: $border-radius;
    margin-bottom: nhs.$nhs-fdp-spacing-3;
    font-size: nhs.$nhs-fdp-font-size-14-tablet;
    color: $color-text-secondary;

    @media (max-width: 768px) {
      flex-direction: column;
      align-items: flex-start;
      gap: nhs.$nhs-fdp-spacing-2;
    }
  }

  &__sort-description {
    flex: 1;
    font-weight: normal;
    
    // Active state class applied when sorts are present
    &--active {
      color: $color-text;
      font-weight: nhs.$nhs-fdp-font-weight-bold;
    }
  }

  &__reset-sorts {
    background: $color-white;
    border: nhs.$nhs-fdp-border-width-default solid $color-primary;
    color: $color-primary;
    padding: nhs.$nhs-fdp-spacing-2 nhs.$nhs-fdp-spacing-3;
    border-radius: $border-radius;
    font-size: nhs.$nhs-fdp-font-size-14-tablet;
    font-weight: nhs.$nhs-fdp-font-weight-bold;
    cursor: pointer;
    transition: $transition-default;
    white-space: nowrap;

    &:hover {
      background: $color-primary;
      color: $color-white;
      box-shadow: nhs.$nhs-fdp-shadow-button-default;
    }

    &:focus-visible {
      outline: nhs.$nhs-fdp-border-width-form-element solid $color-focus;
      outline-offset: 2px;
    }

    &:active {
      transform: translateY(1px);
      box-shadow: none;
    }
  }
}

// Enhanced Focus Styles for Hierarchical Navigation (component-specific styles)
.sortable-header {
  &--focused {
    background-color: $color-primary !important;
	color: $color-white !important;
	// Use layered box-shadow for NHS focus conventions - with !important to override base styling
	box-shadow: 
			inset 0 0 0 nhs.$nhs-fdp-border-width-card-bottom nhs.$nhs-fdp-color-primary-black, // Black inner border
			0 0 0 2px $color-highlight !important; // Yellow outer outline (5px total)
	position: relative;
	z-index: 5;

	.header-label {
		color: $color-white;
	}

	.sort-indicator {
		color: $color-white;
	}

	.sort-arrow {
		color: $color-white;
		fill: $color-white;
		
		&.sort-arrow--asc {
			transform: rotate(-90deg);
		}
		
		&.sort-arrow--desc {
			transform: rotate(90deg);
		}
	}
    
    // Enhanced sort priority when focused - inherit the base styles but with white text
    .sort-priority {
      // Color adjustments for focused state while maintaining base styling
      &--priority-1,
      &--priority-2,
      &--priority-4,
      &--priority-5 {
        // Maintain the background colors but ensure visibility on focused header
        box-shadow: nhs.$nhs-fdp-shadow-card-hover;
        transform: scale(1.05);
      }
	  &--priority-3 {
		// Maintain the background colors but ensure visibility on focused header
		//box-shadow: 0 2px 4px nhs.$nhs-fdp-color-primary-white;
		background: nhs.$nhs-fdp-color-primary-white !important; // Ensure white background for visibility
		color: nhs.$nhs-fdp-color-primary-blue !important;
	  }
      
      &::before {
        // Make sure the priority number is still visible on focused headers
        background: $color-white;
        color: $color-text;
        border: 1px solid $color-primary;
      }
    }
  }
}

// Data cell focus styles (component-specific)
.data-cell {
  &--focused {
    background-color: $color-primary;
	color: nhs.$nhs-fdp-semantic-color-text-primary;
	// Use layered box-shadow to show both black border and yellow outline - with !important to override base styling
	box-shadow: inset 0 0 0 nhs.$nhs-fdp-border-width-card-bottom nhs.$nhs-fdp-color-primary-black, // Black inner border
			0 0 0 5px $color-highlight !important; // Yellow outer outline (5px total)
	border-radius: 0 !important; // Ensure no border radius is applied
	position: relative;
	z-index: 10;
  }
}

// Enhanced sort priority in table headers
.sortable-table-header {
  .sort-priority-container {
    display: inline-flex;
    align-items: center;
    gap: nhs.$nhs-fdp-spacing-1;
    margin-left: nhs.$nhs-fdp-spacing-2;
    
    // Mobile-specific adjustments
    @media (max-width: 768px) {
      gap: calc(nhs.$nhs-fdp-spacing-1 / 2);
      margin-left: nhs.$nhs-fdp-spacing-1;
    }
    
    .sort-priority {
      &--small {
        min-width: 16px;
        height: 16px;
        font-size: 10px;
        
        &::before {
          width: 12px;
          height: 12px;
          font-size: 8px;
          top: -6px;
          right: -6px;
        }
      }
      
      &--large {
        min-width: 24px;
        height: 24px;
        font-size: nhs.$nhs-fdp-font-size-14-tablet;
        
        &::before {
          width: 18px;
          height: 18px;
          font-size: 11px;
          top: -9px;
          right: -9px;
        }
      }
      
      // Multiple sort indicator with connecting lines
      &--connected {
        position: relative;
        
        &::after {
          content: '';
          position: absolute;
          left: 100%;
          top: 50%;
          width: nhs.$nhs-fdp-spacing-2;
          height: 2px;
          background: nhs.$nhs-fdp-color-grey-3;
          transform: translateY(-50%);
        }
        
        &:last-child::after {
          display: none;
        }
      }
    }
  }
}

// Row Selection and Focus Styles (component-specific)
.data-row {
  // Selected row styles
  &--selected {
    background-color: rgba(nhs.$nhs-fdp-color-primary-blue, 0.15); // Lighter blue tint

    &:hover {
      background-color: rgba(nhs.$nhs-fdp-color-primary-blue, 0.25); // Darker on hover
    }

    td {
      background-color: inherit;
      border-color: $color-primary;
    }
  }

  // Focused row styles for keyboard navigation
  &--focused {
    background-color: $color-secondary;
    outline: nhs.$nhs-fdp-spacing-1 solid $color-highlight; // 5px total
    outline-offset: 0px;

    td {
      background-color: inherit;
    }

    // Combined selected and focused state
    &.data-row--selected {
      background-color: rgba(nhs.$nhs-fdp-color-primary-blue, 0.4);
      outline: nhs.$nhs-fdp-spacing-1 + 1px solid $color-highlight; // 5px
    }
  }
}

// Loading spinner (component-specific animation)
.nhsuk-spinner {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: nhs.$nhs-fdp-spacing-1 - 1px solid nhs.$nhs-fdp-color-grey-4; // 3px
  border-top: nhs.$nhs-fdp-spacing-1 - 1px solid $color-primary; // 3px
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

// Priority pulse animation for high-priority sorts
@keyframes pulse-priority {
  0%, 100% {
    transform: scale(1);
    box-shadow: 0 0 0 0 rgba(213, 40, 27, 0.4);
  }
  50% {
    transform: scale(1.05);
    box-shadow: 0 0 0 6px rgba(213, 40, 27, 0.1);
  }
}

// Screen reader only content
.nhsuk-u-visually-hidden {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

// Responsive Design
@media (max-width: 768px) {
  .aria-tabs-datagrid {
    &__tabs {
      flex-wrap: wrap;
    }
    
    &__tab {
      padding: nhs.$nhs-fdp-button-spacing-padding-vertical-mobile nhs.$nhs-fdp-button-spacing-padding-horizontal-mobile;
      font-size: nhs.$nhs-fdp-font-size-14-mobile;
      min-width: 120px; // Component-specific minimum width
    }
    
    &--vertical {
      flex-direction: column;

      .aria-tabs-datagrid__tabs {
        width: 100%;
        flex-direction: row;
        border-right: none;
      }
    }
  }
}

// High Contrast Mode Support
@media (forced-colors: active) {
  .aria-tabs-datagrid__tab {
    border: nhs.$nhs-fdp-border-width-default solid ButtonText;
    
    &--selected {
      background: Highlight;
      color: HighlightText;
    }
  }
  
  // High contrast support for sort priorities
  .sort-priority {
    background: ButtonText !important;
    color: ButtonFace !important;
    border: 2px solid ButtonText !important;
    
    &::before {
      background: ButtonFace !important;
      color: ButtonText !important;
      border: 1px solid ButtonText !important;
    }
    
    &--priority-1 {
      // Use system highlight for highest priority in high contrast
      background: Highlight !important;
      color: HighlightText !important;
    }
  }
  
  .sortable-table-header .sort-priority {
    &--connected::after {
      background: ButtonText !important;
    }
  }
}

// Print Styles
@media print {
  .aria-tabs-datagrid {
    &__tabs {
      display: none;
    }
    
    &__panel {
      &[hidden] {
        display: block;
      }
      
      page-break-inside: avoid;
    }
  }
}
