// SortableDataTable component styles using design tokens
@use '../../../packages/nhs-fdp/scss' as nhs;

.sortable-data-table {
  font-family: nhs.$nhs-fdp-font-family-base, nhs.$nhs-fdp-font-family-fallback;
  width: 100%;
  
  // Ensure smooth scrolling for focused elements
  scroll-behavior: smooth;
  
  // Improve tab focus states
  .nhsuk-tabs {
    margin-bottom: 0;
    font-family: nhs.$nhs-fdp-font-family-base, nhs.$nhs-fdp-font-family-fallback;
    
    .nhsuk-tabs__list {
      .nhsuk-tabs__list-item {
        button {
          position: relative;
          transition: all 0.2s ease;
          font-family: nhs.$nhs-fdp-font-family-base, nhs.$nhs-fdp-font-family-fallback;
          
          &:focus {
            outline: 3px solid nhs.$nhs-fdp-color-primary-yellow;
            outline-offset: 0;
            background-color: nhs.$nhs-fdp-color-primary-yellow;
            box-shadow: 0 0 0 3px nhs.$nhs-fdp-color-primary-yellow;
          }
          
        //   &:hover:not(:focus) {
        //     background-color: nhs.$nhs-fdp-color-grey-5;
        //   }
        }
        
        &.nhsuk-tabs__list-item--selected button {
          border-bottom: 3px solid nhs.$nhs-fdp-color-primary-black;
        }
      }
    }
    
    // Ensure tab panels also use Frutiger
    .nhsuk-tabs__panel {
      font-family: nhs.$nhs-fdp-font-family-base, nhs.$nhs-fdp-font-family-fallback;
    }
  }
  
  // Table styling using design tokens
  .nhsuk-table {
    border-collapse: collapse;
    width: 100%;
    font-family: inherit;
    border: 1px solid nhs.$nhs-fdp-border-color-default;
    
    // Ensure smooth scrolling within the table
    * {
      scroll-behavior: smooth;
    }
    
    .nhsuk-table__head {
      // Entire header should be sticky
      position: sticky;
      top: 0;
      z-index: 10;
      background: nhs.$nhs-fdp-color-primary-white;
      
      // When header row is focused, add visual indication
      &.header-row--focused {
        background: linear-gradient(90deg, 
          nhs.$nhs-fdp-color-primary-yellow 0%, 
          nhs.$nhs-fdp-color-primary-yellow 100%);
        box-shadow: 0 0 0 4px nhs.$nhs-fdp-color-primary-black;
        border-radius: 4px 4px 0 0;
        position: relative;
        z-index: 15;
        
        // &::before {
        //   content: 'HEADER ROW SELECTED';
        //   position: absolute;
        //   top: -25px;
        //   left: 50%;
        //   transform: translateX(-50%);
        //   background: nhs.$nhs-fdp-color-primary-black;
        //   color: nhs.$nhs-fdp-color-primary-white;
        //   padding: 2px 8px;
        //   border-radius: 4px;
        //   font-size: 12px;
        //   font-weight: bold;
        //   z-index: 20;
        //   white-space: nowrap;
        // }
      }
      
      .sortable-header {
        // Remove individual sticky positioning - parent thead is now sticky
        background: nhs.$nhs-fdp-color-primary-white;
        cursor: pointer;
        border-bottom: 2px solid nhs.$nhs-fdp-border-color-default;
        border-right: 1px solid nhs.$nhs-fdp-border-color-default;
        color: nhs.$nhs-fdp-color-primary-black;
        font-weight: nhs.$nhs-fdp-font-weight-bold;
        padding: 0;
        transition: all 0.2s ease;
        
        @include nhs.nhs-fdp-font-size(16);
        
        &:last-child {
          border-right: none;
        }
        
        .header-content {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          padding: 0 nhs.$nhs-fdp-spacing-3;
          min-height: 60px;
          position: relative;
          
          .header-label {
            margin-bottom: nhs.$nhs-fdp-spacing-2;
            text-align: center;
          }
          
          .sort-indicator {
            display: flex;
            align-items: center;
            gap: nhs.$nhs-fdp-spacing-2;
            
            .sort-priority {
              font-weight: nhs.$nhs-fdp-font-weight-bold;
              background: nhs.$nhs-fdp-color-primary-blue;
              color: nhs.$nhs-fdp-color-primary-white;
              border-radius: 50%;
              width: 18px;
              height: 18px;
              display: flex;
              align-items: center;
              justify-content: center;
              @include nhs.nhs-fdp-font-size(14);
            }
            
            .sort-arrow {
              color: nhs.$nhs-fdp-color-primary-blue;
            }
          }
        }
        
        &:hover {
          background-color: nhs.$nhs-fdp-color-grey-5;
        }
        
        &:focus {
          outline: 3px solid nhs.$nhs-fdp-color-primary-yellow;
          outline-offset: -3px;
          background-color: nhs.$nhs-fdp-color-primary-yellow;
          z-index: 11;
        }
        
        // Header focused in browse mode
        &.header--focused {
          //background-color: nhs.$nhs-fdp-color-primary-yellow;
          //box-shadow: inset 0 0 0 4px nhs.$nhs-fdp-color-primary-black;
          position: relative;
          z-index: 12;
          
        //   .header-content {
        //     background: nhs.$nhs-fdp-color-primary-yellow;
        //   }
        }
        
        // Header focused in navigate mode
        &.header--navigating {
          background-color: nhs.$nhs-fdp-color-primary-yellow;
          box-shadow: inset 0 0 0 4px nhs.$nhs-fdp-color-primary-black;
          position: relative;
          z-index: 12;
          
          .header-content {
            //background: nhs.$nhs-fdp-color-primary-yellow;
            font-weight: nhs.$nhs-fdp-font-weight-bold;
          }
        }
        
        // Sorted column styling
        &[aria-sort="ascending"],
        &[aria-sort="descending"] {
          background-color: nhs.$nhs-fdp-color-grey-5;
          
          .header-content .header-label {
            color: nhs.$nhs-fdp-color-primary-blue;
          }
        }
      }
    }
    
    .nhsuk-table__body {
      .data-row {
        border-bottom: 1px solid nhs.$nhs-fdp-border-color-default;
        transition: background-color 0.2s ease;
        
        &:hover {
          background-color: nhs.$nhs-fdp-color-grey-5;
        }
        
        // &.data-row--selected {
        //   background-color: nhs.$nhs-fdp-color-grey-5;
        //   border-left: 4px solid nhs.$nhs-fdp-color-primary-blue;
        // }
        
        &.data-row--focused {
          background-color: nhs.$nhs-fdp-color-primary-yellow;
        }
        
        // Row focused in browse mode
        &.data-row--browse-focused {
          background-color: nhs.$nhs-fdp-color-primary-yellow;
          box-shadow: inset 0 0 0 4px nhs.$nhs-fdp-color-primary-black;
        }
        
        // Row focused in navigate mode  
        &.data-row--navigate-focused {
          background-color: nhs.$nhs-fdp-color-primary-yellow;
          box-shadow: inset 0 0 0 4px nhs.$nhs-fdp-color-primary-black;
          
        //   .data-cell--focused {
        //     font-weight: nhs.$nhs-fdp-font-weight-bold;
        //   }
        }
        
        .data-cell {
          padding: 0 nhs.$nhs-fdp-spacing-3;
          vertical-align: middle;
          color: nhs.$nhs-fdp-color-primary-black;
          text-align: center;
          border-right: 1px solid nhs.$nhs-fdp-border-color-default;
          
          @include nhs.nhs-fdp-font-size(16);
          
          &:last-child {
            border-right: none;
          }
          
			//   &:focus {
			//     outline: 3px solid nhs.$nhs-fdp-color-primary-yellow;
			//     outline-offset: -3px;
			//     background-color: nhs.$nhs-fdp-color-primary-yellow;
			//     z-index: 5;
			//     position: relative;
			//   }
			
			//   &.data-cell--focused {
			//     background-color: nhs.$nhs-fdp-color-primary-yellow;
			//   }
        }
      }
    }
  }
  
  // EWS Score color coding using NHS colors
  .ews-score {
    font-weight: nhs.$nhs-fdp-font-weight-bold;
    @include nhs.nhs-fdp-font-size(16);
    
    &.ews-low {
      color: nhs.$nhs-fdp-color-primary-green;
    }
    
    &.ews-medium {
      color: nhs.$nhs-fdp-color-secondary-orange;
    }
    
    &.ews-high {
      color: nhs.$nhs-fdp-color-primary-red;
    }
  }
  
  // Screen reader only content
  .sr-only {
    position: absolute !important;
    width: 1px !important;
    height: 1px !important;
    padding: 0 !important;
    margin: -1px !important;
    overflow: hidden !important;
    clip: rect(0, 0, 0, 0) !important;
    white-space: nowrap !important;
    border: 0 !important;
  }
  
  // Focus area indicators for keyboard navigation
  &[data-focus-area="tabs"] {
    .nhsuk-tabs__list button:focus {
      outline: 3px solid nhs.$nhs-fdp-color-primary-yellow;
      outline-offset: 0;
    }
  }
  
  &[data-focus-area="headers"] {
    .sortable-header:focus {
      outline: 3px solid nhs.$nhs-fdp-color-primary-yellow;
      outline-offset: -3px;
    }
  }
  
  &[data-focus-area="cells"] {
    .data-cell:focus {
      outline: 0px solid nhs.$nhs-fdp-color-primary-yellow;
      outline-offset: -3px;
    }
  }
}

// Responsive adjustments
@media (max-width: calc(#{nhs.$nhs-fdp-breakpoint-medium} - 1px)) {
  .sortable-data-table {
    .nhsuk-tabs .nhsuk-tabs__list {
      flex-direction: column;
      
      .nhsuk-tabs__list-item button {
        padding: nhs.$nhs-fdp-spacing-5;
        width: 100%;
      }
    }
    
    .nhsuk-table {
      .nhsuk-table__head .sortable-header {
        .header-content {
          padding: nhs.$nhs-fdp-spacing-3 nhs.$nhs-fdp-spacing-2;
          min-height: 50px;
          
          .header-label {
            @include nhs.nhs-fdp-font-size(14);
          }
        }
      }
      
      .nhsuk-table__body .data-row .data-cell {
        padding: nhs.$nhs-fdp-spacing-3 nhs.$nhs-fdp-spacing-2;
        @include nhs.nhs-fdp-font-size(14);
      }
    }
  }
}

// High contrast mode support
@media (prefers-contrast: high) {
  .sortable-data-table {
    .nhsuk-table {
      border: 2px solid;
      
      .nhsuk-table__head .sortable-header,
      .nhsuk-table__body .data-row .data-cell {
        border: 1px solid;
      }
    }
    
    .data-row--selected {
      outline: 2px solid;
    }
  }
}

// Reduced motion support
@media (prefers-reduced-motion: reduce) {
  .sortable-data-table {
    .nhsuk-tabs .nhsuk-tabs__list .nhsuk-tabs__list-item button,
    .nhsuk-table .nhsuk-table__head .sortable-header,
    .nhsuk-table .nhsuk-table__body .data-row {
      transition: none;
    }
  }
}
